---
title: "pico-jxgLABO で GPIO 制御をマスターする"
emoji: "👏"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["組み込み", "raspberrypi", "pico", "raspberrypipico", "GPIO制御"]
published: false
---
**pico-jxgLABO** は、Pico ボードで実際に様々な機能を試すことができる実験プラットフォームです。

この記事では、pico-jxgLABO を使った GPIO の制御方法を紹介します。たかが On/Off の入出力機能と思って、設定もなんとなくうやむやにしてしまいがちですが、コマンド操作でいろいろ試すことで GPIO の制御をより深く理解することができます。

## pico-jxgLABO の導入方法

以下の記事にて、pico-jxgLABO の導入方法を詳しく解説しています。まずはこの手順に従って環境を整えてください。

https://zenn.dev/ypsitau/articles/2025-08-01-labo-intro

## GPIO の制御

`gpio` コマンドを使って GPIO の制御を行います。

### 現在の GPIO 状態の表示

引数なしで `gpio` を実行すると、現在の GPIO の状態が表示されます。

```text
L:/>gpio
GPIO0  lo  func:------     dir:in  pull:down drive:4mA slew:slow
GPIO1  lo  func:------     dir:in  pull:down drive:4mA slew:slow
GPIO2  lo  func:------     dir:in  pull:down drive:4mA slew:slow
GPIO3  lo  func:------     dir:in  pull:down drive:4mA slew:slow
GPIO4  lo  func:------     dir:in  pull:down drive:4mA slew:slow
GPIO5  lo  func:------     dir:in  pull:down drive:4mA slew:slow
GPIO6  lo  func:------     dir:in  pull:down drive:4mA slew:slow
GPIO7  lo  func:------     dir:in  pull:down drive:4mA slew:slow
GPIO8  lo  func:------     dir:in  pull:down drive:4mA slew:slow
GPIO9  lo  func:------     dir:in  pull:down drive:4mA slew:slow
GPIO10 lo  func:------     dir:in  pull:down drive:4mA slew:slow
GPIO11 lo  func:------     dir:in  pull:down drive:4mA slew:slow
GPIO12 lo  func:------     dir:in  pull:down drive:4mA slew:slow
GPIO13 lo  func:------     dir:in  pull:down drive:4mA slew:slow
GPIO14 lo  func:------     dir:in  pull:down drive:4mA slew:slow
GPIO15 lo  func:------     dir:in  pull:down drive:4mA slew:slow
GPIO16 lo  func:------     dir:in  pull:down drive:4mA slew:slow
GPIO17 lo  func:------     dir:in  pull:down drive:4mA slew:slow
GPIO18 lo  func:------     dir:in  pull:down drive:4mA slew:slow
GPIO19 lo  func:------     dir:in  pull:down drive:4mA slew:slow
GPIO20 lo  func:------     dir:in  pull:down drive:4mA slew:slow
GPIO21 lo  func:------     dir:in  pull:down drive:4mA slew:slow
GPIO22 lo  func:------     dir:in  pull:down drive:4mA slew:slow
GPIO23*lo  func:------     dir:in  pull:down drive:4mA slew:slow
GPIO24*lo  func:------     dir:in  pull:down drive:4mA slew:slow
GPIO25*lo  func:------     dir:in  pull:down drive:4mA slew:slow
GPIO26 lo  func:------     dir:in  pull:down drive:4mA slew:slow
GPIO27 lo  func:------     dir:in  pull:down drive:4mA slew:slow
GPIO28 lo  func:------     dir:in  pull:down drive:4mA slew:slow
GPIO29*lo  func:------     dir:in  pull:down drive:4mA slew:slow
```

Pico の GPIO は 0 から 29 までの 30 本があります。ただし、上の状態表示で `*` がついている GPIO23, GPIO24, GPIO25, GPIO29 は外部ピンに接続されておらず、以下のような特殊用途に割り当てられています。

Pico および Pico 2:

- GPIO23 - OP Controls the on-board SMPS Power Save pin
- GPIO24 - IP VBUS sense - high if VBUS is present, else low
- GPIO25 - OP Connected to user LED
- GPIO29 - IP Used in ADC mode (ADC3) to measure VSYS/3

Pico W および Pico 2 W:

- GPIO23 - OP wireless power on signal
- GPIO24 - OP/IP wireless SPI data/IRQ
- GPIO25 - OP wireless SPI CS - when high also enables GPIO29 ADC pin to read VSYS
- GPIO29 - OP/IP wireless SPI CLK/ADC mode (ADC3) to measure VSYS/3

これらのピンは誤った操作をするとボードの動作に影響を与える可能性があるので、gpio` コマンドでは操作ができません。ただし、Pico や Pico 2 の GPIO25 は内蔵 LED につながれており、手軽に使えて便利なので、オプション `--builtin-led` (または `-B`) をつけることで操作可能にしています。

各フィールドの意味は以下の通りです。

- 二番目のフィールドの `lo`, `hi` は各ピンのロジック値を示しています。`lo` は Low (0)、`hi` は High (1) を意味します。
- `func` は GPIO に割り当てられているファンクションをあらわします。`------` は何のファンクションも割り当てられていない (null function) ことを示します
- `dir` はピンの方向を示し、`in` は入力、`out` は出力を意味します。
- `pull` はプルアップ/プルダウン抵抗の設定で、`down` はプルダウン、`up` はプルアップを意味します。
- `drive` はドライブ強度で、通常は 4mA が設定されています。
- `slew` はスルーレート制御で、通常は `slow` が設定されています。

### デジタル入出力について

GPIO を出力モードに設定してデジタル信号を出力してみます。以下は内蔵 LED が接続された GPIO25 に High レベルのデジタル信号を出力して LED を点灯する例です。

```text
L:/>gpio 25 -B func:sio dir:out put:1
```

サブコマンド `func` で設定している `sio` はシングルサイクル IO (Single-cycle IO) の略です。SIO は CPU が 1 サイクルでアクセスできる特殊なブロックで、そのレジスタの一部が GPIO の入出力に割り当てられています。サブコマンド `dir` で出力モードに設定し、`put` で出力値を指定します。

`gpio` コマンドにはリピート処理をするサブコマンド `repeat` や、ディレイを実行するサブコマンド `sleep` があります。これらを使って以下のように LED を点滅させることができます。

```text
L:/>gpio 25 -B func:sio dir:out repeat:20 {put:1 sleep:100 put:0 sleep:100}
```

ロジックアナライザを使って GPIO の信号を観測することもできます。

```text
L:/>la enable -p 25
L:/>gpio 25 -B func:sio dir:out repeat:20 {put:1 sleep:100 put:0 sleep:100}
L:/>la print
```

`la enable` でキャプチャを開始してから GPIO の出力を行い、最後に `la print` でキャプチャしたデータを表示します。

次に GPIO を入力モードに設定してデジタル信号を入力してみます。以下は GPIO0 を入力モードに設定し、信号レベルを読み取る例です。ピンにジャンパ線をつなぎ、VCC や GND に接続して信号を変化させてみてください。`Ctrl-C` で中断できます。

```text
L:/>gpio 0 func:sio dir:in pull:up repeat {get sleep:300}
```

サブコマンド `dir` で入力モードに設定します。サブコマンド `pull` でプルアップ抵抗を有効にしているのは、信号が不定な状態にならないようにするためです。`get` は GPIO の信号レベルを読み取るサブコマンドです。

ところで、Pico では GPIO のファンクションが何に設定されていてもピンの信号レベルを読み取ることができます。以下のようにすると UART TX 機能が割り当てられた GPIO0 の信号レベルを読み取ることができます。

```text
L:/>gpio 0 func:uart dir:in repeat {get sleep:300}
```

### プルアップとプルダウンについて

GPIO ピンの信号が不定な状態にならないようにプルアップ抵抗やプルダウン抵抗を設定することができます。これにより、ピンが接続されていないときの信号レベルを明確にすることができます。

`gpio` コマンドでは、プルアップ抵抗を有効にするには `pull:up`、プルダウン抵抗を有効にするには `pull:down` を指定します。`pull:none` を指定するとプルアップ/プルダウン抵抗は無効になり、ハイインピーダンス状態になります。

ところで、Pico のプルアップ、プルダウンの抵抗値は 25kΩ 程度だそうです。これは、例えば I2C 通信をしようとしてプルアップを設ける際、推奨されるプルアップ抵抗値は 1kΩ から 10kΩ なので、かなり高めです。面倒くさがらず、外部にきちんと抵抗を設けるのが得策といえます。
 
:::message
Pico 2 の GPIO の設計にはバグがあって、プルダウン設定が正しく機能しないようです (詳細は[こちら](https://fabscene.com/new/news/raspberry-pi-rp2350-a4-rp2354-announcement/))。

実際、以下のコマンドを Pico 2 で実行すると:

```text
L:/>gpio 0 func:sio dir:in pull:down repeat {get sleep:300}
```

ピンに入力がないときは常に Low レベルになることが期待されるのに、実際は不安定な状態になります。Pico 2 のピンをプルダウンさせるには、外部抵抗が必要です。

この現象はチップの刻印が "P2350A0A2" である場合に発生します。2025年7月29日にアナウンスされた修正版のチップでは "P2350A0A4" となっており、この版ではプルダウン抵抗が正しく機能するようです。
:::

### ドライブ強度について

GPIO の出力モードでは出力する電流の最大値を示します。通常は 4mA に設定されていますが、必要に応じて変更することができます。

## 参考資料

[Raspberry Pi Pico Datasheet](https://datasheets.raspberrypi.com/pico/pico-datasheet.pdf) 2.1. Raspberry Pi Pico pinout
[Raspberry Pi Pico W Datasheet](https://datasheets.raspberrypi.com/pico/pico-2-datasheet.pdf) 2.1. Pico W pinout
[Raspberry Pi Pico 2 Datasheet](https://datasheets.raspberrypi.com/picow/pico-w-datasheet.pdf) 3.1. Raspberry Pi Pico 2 pinout
[Raspberry Pi Pico 2 W Datasheet](https://datasheets.raspberrypi.com/picow/pico-2-w-datasheet.pdf) 2.1. Pico 2 W pinout

---
title: "pico-jxglib ã§ Pico ãƒœãƒ¼ãƒ‰ã« SDCard ã‚„ USB ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’æ¥ç¶šã™ã‚‹è©±"
emoji: "ğŸ™†"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["çµ„ã¿è¾¼ã¿", "raspberrypi", "pico", "raspberrypipico", "usb"]
published: false
---
**pico-jxglib** ã¯ã€ãƒ¯ãƒ³ãƒœãƒ¼ãƒ‰ãƒã‚¤ã‚³ãƒ³ Raspberry Pi Pico ã® Pico SDK ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚

https://zenn.dev/ypsitau/articles/2025-01-24-jxglib-intro

ä»Šå›ã¯ã€Pico ãƒœãƒ¼ãƒ‰ã« SDCard ã‚„ USB ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’æ¥ç¶šã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã¨ã—ã¦ä½¿ãˆã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒ¢ãƒªã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®è¨˜äº‹ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

[pico-jxglib ã§ Pico ãƒœãƒ¼ãƒ‰ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè£…ã—ã¦ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒ¢ãƒªã‚’ãƒ•ãƒ«æ´»ç”¨ã™ã‚‹è©±](https://zenn.dev/ypsitau/articles/2025-05-31-fs-flash)

## SDCard ã«ã¤ã„ã¦

SDCard ã¯ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã§ã‚‚ä½¿ã‚ã‚Œã¦ã„ã‚‹ãŠãªã˜ã¿ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã§ã€ã‚³ãƒ³ãƒ“ãƒ‹ã‚¨ãƒ³ã‚¹ã‚¹ãƒˆã‚¢ã§ã‚‚æ‰‹ã«å…¥ã‚‹ã»ã©èº«è¿‘ãªå­˜åœ¨ã§ã™ã€‚ãã‚Œã ã‘ã«ã€çµ„è¾¼ã¿ãƒ‡ãƒã‚¤ã‚¹ã«æ¥ç¶šã™ã‚‹ã®ã‚‚ç°¡å˜ã ã‚ã†ã¨æ€ã„ãŒã¡ã§ã™ãŒã€å®Ÿã¯ãã†ã§ã‚‚ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã“ã§ã¯ã€SDCard ã®æ¥ç¶šæ–¹æ³•ã‚„ã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®æ³¨æ„ç‚¹ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€‚

### SDCard ã®æ¥ç¶šæ–¹æ³•

SDCard ã®æ¥ç¶šæ–¹æ³•ã‚„åˆ¶å¾¡æ–¹æ³•ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®ã‚µã‚¤ãƒˆã«è©³ã—ã„æƒ…å ±ãŒã‚ã‚Šã¾ã™ã€‚

[MMC/SDC ã®ä½¿ã„æ–¹](https://elm-chan.org/docs/mmc/mmc.html)

SDCard ã‚’æ¥ç¶šã™ã‚‹éš›ã«ã¯ã€ä»¥ä¸‹ã®ã“ã¨ãŒã‚‰ã‚’æœ€ä½é™çŸ¥ã£ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

- SDCard ã®é›»æºã¯ **3.3V** ã§ã™
- SDCard ã®ä¿¡å·ç·šã¯ãƒ—ãƒ«ã‚¢ãƒƒãƒ—æŠµæŠ—ãŒå¿…è¦ã§ã™

SDCard ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å›è·¯ã¯ SDCard ãã‚Œè‡ªä½“ã«çµ„ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã®ã§ã€SDCard ã®ãƒ”ãƒ³ã‚’ç›´æ¥ãƒœãƒ¼ãƒ‰ã«æ¥ç¶šã—ã¦ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚ã§ã‚‚ã€ãƒªãƒ ãƒ¼ãƒãƒ–ãƒ«ãƒ¡ãƒ‡ã‚£ã‚¢ã¨ã—ã¦ã®ä½¿ã„å‹æ‰‹ã‚’è€ƒãˆã‚‹ã¨ã€ã”ãè‡ªç„¶ã«ã‚¢ãƒ€ãƒ—ã‚¿ã‚’ä½¿ã†ã“ã¨ã«ãªã‚‹ã§ã—ã‚‡ã†ã€‚ã“ã“ã§å•é¡Œã«ãªã‚‹ã®ã¯ã€ã‚¢ãƒ€ãƒ—ã‚¿ã®ç¨®é¡ã¨æ¥ç¶šæ–¹æ³•ã§ã™ã€‚SDCard ã‚¢ãƒ€ãƒ—ã‚¿ã¯ã€åŸºæœ¬çš„ã« SDCard ã‚¹ãƒ­ãƒƒãƒˆã¨ã„ãã¤ã‹ã®æŠµæŠ—ã‚„ä¸‰ç«¯å­ãƒ¬ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚¿ãŒè¼‰ã£ã¦ã„ã‚‹ã ã‘ã®ã‚·ãƒ³ãƒ—ãƒ«ãªã‚‚ã®ã§ã™ãŒã€ä¸ãˆã‚‹é›»åœ§ã‚„ä¿¡å·ã®ãƒ¬ãƒ™ãƒ«ã€ãƒ—ãƒ«ã‚¢ãƒƒãƒ—æŠµæŠ—ã®æœ‰ç„¡ãªã©ãŒã‚¢ãƒ€ãƒ—ã‚¿ã«ã‚ˆã£ã¦ç•°ãªã‚‹ã®ã§æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚

ä»¥ä¸‹ã€æ‰‹å…ƒã«ã‚ã‚‹ SDCard ã‚¢ãƒ€ãƒ—ã‚¿ (ä¸»ã« Amazon ã§å…¥æ‰‹) ã”ã¨ã«æ¥ç¶šæ–¹æ³•ã‚’ç¢ºèªã—ã¦ã„ãã¾ã™ã€‚

### SDCard ãƒ‰ãƒ©ã‚¤ãƒã«ã¤ã„ã¦

SDCard ã«ã¯ SPI ãƒ¢ãƒ¼ãƒ‰ã¨ SDIO ãƒ¢ãƒ¼ãƒ‰ã®äºŒã¤ã®ãƒ¢ãƒ¼ãƒ‰ã‚’ãŒã‚ã‚Šã¾ã™ã€‚SPI ãƒ¢ãƒ¼ãƒ‰ã¯ã€SDCard ã‚’ SPI ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§æ¥ç¶šã™ã‚‹ãŸã‚ã®ãƒ¢ãƒ¼ãƒ‰ã§ã€SDIO ãƒ¢ãƒ¼ãƒ‰ã¯ SDCard ã®ãƒã‚¤ãƒ†ã‚£ãƒ–ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§æ¥ç¶šã™ã‚‹ãŸã‚ã®ãƒ¢ãƒ¼ãƒ‰ã§ã™ã€‚SDIO ã®æ–¹ãŒé«˜é€Ÿã§ SDCard ã®æ©Ÿèƒ½ã‚’ãƒ•ãƒ«ã«æ´»ç”¨ã§ãã¾ã™ãŒã€Pico ãƒœãƒ¼ãƒ‰ã§å‹•ã‹ã—ã¦ã„ã‚‹ä¾‹ã¯ã¨ã¦ã‚‚å°‘ãªã„ã§ã™ã€‚**pico-jxglib** ã§ã¯å®Ÿè£…ä¾‹ã®è±Šå¯Œãª SPI ãƒ¢ãƒ¼ãƒ‰ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚

SDCard ã¯ã‚«ãƒ¼ãƒ‰è‡ªä½“ã«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å›è·¯ã‚’å†…è”µã—ã¦ã„ã¾ã™ãŒã€ã“ã®ã“ã¨ã¯ SDCard ã”ã¨ã«å¾®å¦™ã«ç•°ãªã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ä»•æ§˜ãŒå­˜åœ¨ã—ã¦ã„ã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚ãã®ãŸã‚ã€ãƒ‰ãƒ©ã‚¤ãƒã‚’ä½œæˆã—ã¦ã‚‚ã€ã„ã‚ã„ã‚ãª SDCard ã§å‹•ä½œå®Ÿç¸¾ã‚’ã¤ã¾ãªã„ã¨å®Ÿéš›ã«ä½¿ãˆã‚‹ã‚‚ã®ã«ã¯ãªã‚Šã¾ã›ã‚“ã€‚ãã“ã§ **pico-jxglib** ã§ã¯ã€å¤šãã®ãƒ¦ãƒ¼ã‚¶ãŒä½¿ã£ã¦ã„ã‚‹ã§ã‚ã‚ã†[MicroPython ã® SDCard ãƒ‰ãƒ©ã‚¤ãƒ](https://github.com/micropython/micropython-lib/blob/master/micropython/drivers/storage/sdcard/sdcard.py)ã‚’ C++ ã§æ›¸ãæ›ãˆã¦ã€ãã‚Œã‚’ãƒ™ãƒ¼ã‚¹ã«ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«çµ„ã¿è¾¼ã¾ã—ãŸã€‚ã“ã‚Œã§æ±ç”¨æ€§ã®é«˜ã„ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«ãªã£ã¦ã„ã‚‹ã¯ãš...ã€‚ãªã«ã¯ã¨ã‚‚ã‚ã‚Œã€MicroPython ã•ã‚“ã«ã¯æ„Ÿè¬ã§ã™ã€‚

## USB ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã¤ã„ã¦

Pico ãƒœãƒ¼ãƒ‰ã§ã¯ USB ãƒ›ã‚¹ãƒˆæ©Ÿèƒ½ã‚’ä½¿ã£ã¦ USB ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’æ¥ç¶šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚tinyusb ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ç”¨æ„ã•ã‚Œã¦ã„ã‚‹ Mass Storage Class ã‚’ä½¿ã£ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã« USB ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ãƒãƒ³ãƒ‰ãƒ©ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

## å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

### é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

Visual Studio Code ã‚„ Git ãƒ„ãƒ¼ãƒ«ã€Pico SDK ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒæ¸ˆã‚“ã§ã„ãªã„æ–¹ã¯[ã€ŒPico SDK ã“ã¨ã¯ã˜ã‚ã€](https://zenn.dev/ypsitau/articles/2025-01-17-picosdk#%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83) ã‚’ã”è¦§ãã ã•ã„ã€‚

GitHub ã‹ã‚‰ **pico-jxglib** ã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¾ã™ã€‚

```bash
git clone https://github.com/ypsitau/pico-jxglib.git
cd pico-jxglib
git submodule update --init
```

:::message
**pico-jxglib** ã¯ã»ã¼æ¯æ—¥æ›´æ–°ã•ã‚Œã¦ã„ã¾ã™ã€‚ã™ã§ã«ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¦ã„ã‚‹å ´åˆã¯ã€`pico-jxglib` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦æœ€æ–°ã®ã‚‚ã®ã«ã—ã¦ãã ã•ã„ã€‚

```bash
git pull
```

:::

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

VSCode ã®ã‚³ãƒãƒ³ãƒ‰ãƒ‘ãƒ¬ãƒƒãƒˆã‹ã‚‰ `>Raspberry Pi Pico: New Pico Project` ã‚’å®Ÿè¡Œã—ã€ä»¥ä¸‹ã®å†…å®¹ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚Pico SDK ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆã®è©³ç´°ã‚„ã€ãƒ“ãƒ«ãƒ‰ã€ãƒœãƒ¼ãƒ‰ã¸ã®æ›¸ãè¾¼ã¿æ–¹æ³•ã«ã¤ã„ã¦ã¯[ã€ŒPico SDK ã“ã¨ã¯ã˜ã‚ã€](https://zenn.dev/ypsitau/articles/2025-01-17-picosdk#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90%E3%81%A8%E7%B7%A8%E9%9B%86) ã‚’å‚ç…§ãã ã•ã„ã€‚

- **Name** ... ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’å…¥åŠ›ã—ã¾ã™ã€‚ä»Šå›ã¯ä¾‹ã¨ã—ã¦ `fs-media` ã‚’å…¥åŠ›ã—ã¾ã™
- **Board type** ... ãƒœãƒ¼ãƒ‰ç¨®åˆ¥ã‚’é¸æŠã—ã¾ã™
- **Location** ... ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œã‚‹ä¸€ã¤ä¸Šã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’é¸æŠã—ã¾ã™
- **Stdio support** .. Stdio ã«æ¥ç¶šã™ã‚‹ãƒãƒ¼ãƒˆ (UART ã¾ãŸã¯ USB) ã‚’é¸æŠã—ã¾ã™
- **Code generation options** ... **`Generate C++ code` ã«ãƒã‚§ãƒƒã‚¯ã‚’ã¤ã‘ã¾ã™**

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ `pico-jxglib` ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ç½®ãŒä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã¨æƒ³å®šã—ã¾ã™ã€‚

```text
â”œâ”€â”€ pico-jxglib/
â””â”€â”€ fs-media/
    â”œâ”€â”€ CMakeLists.txt
    â”œâ”€â”€ fs-media.cpp
    â””â”€â”€ ...
```

ä»¥ä¸‹ã€ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚‚ã¨ã« `CMakeLists.txt` ã‚„ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¦ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚

### SDCard ã®æ¥ç¶š

`CMakeLists.txt` ã®æœ€å¾Œã«ä»¥ä¸‹ã®è¡Œã‚’è¿½åŠ ã—ã¾ã™ã€‚

```cmake
target_link_libraries(fs-media jxglib_FAT_SDCard)
add_subdirectory(${CMAKE_CURRENT_LIST_DIR}/../pico-jxglib pico-jxglib)
jxglib_configure_FAT(fs-media FF_VOLUMES 1)
```

ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¾ã™ã€‚


```cpp:fs-media.cpp
#include "pico/stdlib.h"
#include "jxglib/FAT/SDCard.h"

using namespace jxglib;

int main()
{
    ::stdio_init_all();
    GPIO2.set_function_SPI0_SCK();
    GPIO3.set_function_SPI0_TX();
    GPIO4.set_function_SPI0_RX();
    FAT::SDCard driveSD("SD:", spi0, 10'000'000, {CS: GPIO5});
    // any job
}

```


### USB ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®æ¥ç¶š

`CMakeLists.txt` ã®æœ€å¾Œã«ä»¥ä¸‹ã®è¡Œã‚’è¿½åŠ ã—ã¾ã™ã€‚

```cmake
target_link_libraries(fs-media jxglib_FAT_USBMSC)
add_subdirectory(${CMAKE_CURRENT_LIST_DIR}/../pico-jxglib pico-jxglib)
jxglib_configure_FAT(fs-media FF_VOLUMES 1)
jxglib_configure_USBHost(test-Composite CFG_TUH_MSC 1)
```

ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¾ã™ã€‚

```cpp:fs-media.cpp
#include "pico/stdlib.h"
#include "jxglib/FAT/USBMSC.h"

using namespace jxglib;

int main()
{
    ::stdio_init_all();
    USBHost::Initialize();
    FAT::USBMSC driveUSB("USB:");
    // any job
```


`CMakeLists.txt` ã®æœ€å¾Œã«ä»¥ä¸‹ã®è¡Œã‚’è¿½åŠ ã—ã¾ã™ã€‚

```cmake
target_link_libraries(fs-media jxglib_FAT_USBMSC)
add_subdirectory(${CMAKE_CURRENT_LIST_DIR}/../pico-jxglib pico-jxglib)
jxglib_configure_FAT(fs-media FF_VOLUMES 2)
jxglib_configure_USBHost(test-Composite CFG_TUH_MSC 2)
```

ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¾ã™ã€‚

```cpp:fs-media.cpp
#include "pico/stdlib.h"
#include "jxglib/FAT/USBMSC.h"

using namespace jxglib;

int main()
{
    ::stdio_init_all();
    USBHost::Initialize();
    FAT::USBMSC driveUSB1("USB1:");
    FAT::USBMSC driveUSB2("USB2:");
    // any job
```

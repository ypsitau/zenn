---
title: "pico-jxglib ã¨ Terminal ã®è©±"
emoji: "ğŸ£"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["çµ„ã¿è¾¼ã¿", "raspberrypi", "pico", "raspberrypipico"]
published: true
---
**pico-jxglib** ã¯ã€ãƒ¯ãƒ³ãƒœãƒ¼ãƒ‰ãƒã‚¤ã‚³ãƒ³ Raspberry Pi Pico ã® Pico SDK ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚

https://zenn.dev/ypsitau/articles/2025-01-24-jxglib-intro

ä»Šå›ã¯ã€TFT LCD ã« Terminal ã®æ©Ÿèƒ½ã‚’æŒãŸã›ã‚‹ãŠè©±ã§ã™ã€‚ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ©Ÿèƒ½ã‚’ä½¿ã†ã“ã¨ã§ç‹­ã„ç”»é¢ã§ã‚‚å¤šãã®æƒ…å ±ã‚’è¡¨ç¤ºã§ãã¾ã™ã—ã€å‡ºåŠ›å†…å®¹ã‚’å¾Œã‹ã‚‰èª­ã¿å‡ºã™ã“ã¨ãŒã§ãã‚‹ã®ã§ãƒ‡ãƒ¼ã‚¿ãƒ­ã‚¬ãƒ¼ã¨ã—ã¦ã‚‚å½¹ã«ç«‹ã¡ã¾ã™ã‚ˆãƒ¼ã€‚

## Terminal æ©Ÿèƒ½ã«ã¤ã„ã¦

ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã¨ã„ã†ã¨ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯æç”»ã‚„ GUI ãªã©è¦‹æ „ãˆã®ã™ã‚‹éƒ¨åˆ†ã«ç›®ãŒã„ããŒã¡ã§ã™ãŒã€å®Ÿç”¨é€”ã§ã¯æ§˜ã€…ãªãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹å ´é¢ãŒã‹ãªã‚Šå¤šã„ã®ã§ã¯ãªã„ã‹ã¨æ€ã„ã¾ã™ã€‚ãã®ç›®çš„ã®ãŸã‚ã«ã¯ã€Œç”»é¢ä¸­ã®åº§æ¨™ã‚’æŒ‡å®šã—ã¦ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡¨ç¤ºã™ã‚‹ã€ã¨ã„ã†æ©Ÿèƒ½ã§ã¯ã”ãé™ã‚‰ã‚ŒãŸé‡ã®æƒ…å ±ã—ã‹å‡ºåŠ›ã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚åº§æ¨™æŒ‡å®šã®å¿…è¦ã‚‚ãªãã€æ–‡å­—åˆ—ã‚’é€ã£ã¦ã„ã‘ã°è‡ªå‹•çš„ã«æç”»ä½ç½®ã‚’æ›´æ–°ã—ã¦ã„ãã€ç”»é¢ãŒã‚ãµã‚ŒãŸã¨ãã«ã¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ã—ã¦ãã‚Œã‚‹ã¨ã„ã†ã€ã„ã‚ã‚†ã‚‹ Terminal ã®æ©Ÿèƒ½ãŒã¨ã¦ã‚‚ä¾¿åˆ©ãªã®ã§ã™ã€‚

**pico-jxglib** ã® Terminal ã¯ã€ã”ãè‡ªç„¶ã«æœŸå¾…ã•ã‚Œã‚‹ã§ã‚ã‚ã†ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’æŒã¡ã¾ã™ã€‚

1. æç”»ä½ç½®ã‚’æ›´æ–°ã—ãªãŒã‚‰æ–‡å­—ã‚„æ–‡å­—åˆ—ã‚’æç”»ã™ã‚‹æ©Ÿèƒ½
1. ç”»é¢ã®å³ç«¯ã«é”ã—ãŸã‚‰è‡ªå‹•ã§æ”¹è¡Œã™ã‚‹æ©Ÿèƒ½
1. ç”»é¢ã®æœ€ä¸‹ç«¯ã«é”ã—ãŸã‚‰ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã™ã‚‹æ©Ÿèƒ½
1. ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒãƒƒãƒ•ã‚¡ã«å‡ºåŠ›å†…å®¹ã‚’è¨˜éŒ²ã—ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§ãã‚‹æ©Ÿèƒ½
1. ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒãƒƒãƒ•ã‚¡ã®å†…å®¹ã‚’èª­ã¿å‡ºã™æ©Ÿèƒ½

ç‰¹ã«ã€æœ€å¾Œã«æŒ™ã’ãŸãƒ©ã‚¦ãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒãƒƒãƒ•ã‚¡ã®èª­ã¿å‡ºã—æ©Ÿèƒ½ã¯ã€ã“ã‚Œã‹ã‚‰ **pico-jxglib** ã«å®Ÿè£…ã—ã¦ã„ãäºˆå®šã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ©Ÿèƒ½ã‚„ä»–ãƒ‡ãƒã‚¤ã‚¹ã¨ã®é€šä¿¡æ©Ÿèƒ½ã¨çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ãƒ‡ãƒ¼ã‚¿ãƒ­ã‚¬ãƒ¼ã¨ã—ã¦æœ‰åŠ¹ã«åƒãã¨æœŸå¾…ã•ã‚Œã¾ã™ã€‚

ã¨ã“ã‚ã§ã€Terminal ã‚’ä½¿ã£ãŸå®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å‰ã«ã€ãƒ¯ãƒ³ãƒœãƒ¼ãƒ‰ãƒã‚¤ã‚³ãƒ³ã®å‘¨è¾ºæ©Ÿå™¨ã§ TFT LCD ã¨ä¸¦ã‚“ã§ãƒãƒ”ãƒ¥ãƒ©ãƒ¼ãªè¡¨ç¤ºæ©Ÿå™¨ã§ã‚ã‚‹ OLED ãƒ‡ãƒã‚¤ã‚¹ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

## OLED ãƒ‡ãƒã‚¤ã‚¹

çµ„è¾¼ã¿ç”¨é€”ã§ã‚ˆãã¿ã‹ã‘ã‚‹ OLED (æœ‰æ©Ÿ EL ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤) ã¯ã€SSD1306 ã¨ã„ã† I2C ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§åˆ¶å¾¡ã™ã‚‹ãƒ‡ãƒã‚¤ã‚¹ã«ãªã‚Šã¾ã™[^ssd1306]ã€‚ç”»é¢ã‚µã‚¤ã‚º 0.96 ã‚¤ãƒ³ãƒã€ãƒ”ã‚¯ã‚»ãƒ«æ•°ã¯ 128x64ã€è‰²ã¯ç™½å˜è‰²ã®ã¿ã§ã™ãŒã€è‡ªç™ºå…‰ã—ã¦ã„ã‚‹ã®ã§ã¨ã¦ã‚‚ãã£ãã‚Šè¦‹ãˆã¾ã™ã€‚ä¸€å€‹ 500 å††ç¨‹åº¦ã¨å®‰ä¾¡ãªã®ã‚‚é­…åŠ›çš„ã§ã™ã€‚

[^ssd1306]: åˆ¶å¾¡ç”¨ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨ã—ã¦ SPI ã‚’æ­è¼‰ã—ã¦ã„ãŸã‚Šã€ãƒ”ã‚¯ã‚»ãƒ«æ•°ãŒç•°ãªã‚‹ãƒ‡ãƒã‚¤ã‚¹ã‚‚ã‚ã‚Šã¾ã™ãŒã€ã“ã“ã§æŒ™ã’ãŸãƒ‡ãƒã‚¤ã‚¹ãŒæœ€ã‚‚å…¥æ‰‹ã—ã‚„ã™ã„ã‚ˆã†ã§ã™ã€‚

![SSD1306.jpg](/images/2025-02-19-terminal/SSD1306.jpg)

ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒ I2C ãªã®ã§ã€ä¿¡å·ç·šãŒãŸã£ãŸ 2 æœ¬ã§æ¸ˆã‚€ã¨ã„ã†ã®ã‚‚ã†ã‚Œã—ã„ã§ã™ã­ã€‚SPI ã«æ¯”ã¹ã‚‹ã¨é€šä¿¡é€Ÿåº¦ã¯é…ã„ã®ã§ã™ãŒã€ãã‚‚ãã‚‚ SSD1306 ã®ãƒ”ã‚¯ã‚»ãƒ«ã‚ãŸã‚Šã®ãƒ‡ãƒ¼ã‚¿é‡ã¯ RGB565 ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã® TFT LCD ã«æ¯”ã¹ã¦ 1/16 ã§ã€ç”»é¢å…¨ä½“ã®ãƒ‡ãƒ¼ã‚¿é‡ã‚‚ 128 * 64 / 8 = 1024 bytes ã§ã™ã€‚I2C ã®å‹•ä½œã‚¯ãƒ­ãƒƒã‚¯ã‚’ 400kHz ã«ã—ãŸã¨ãã€ç”»é¢å…¨ä½“ã®ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã«å¿…è¦ãªæ™‚é–“ã¯å®Ÿæ¸¬ã§ 26 msec ç¨‹åº¦ã§ã—ãŸã‹ã‚‰ ([ãƒ—ãƒ­ã‚°ãƒ©ãƒ ](https://github.com/ypsitau/pico-jxglib/blob/main/Display/test-RefreshRate/test-RefreshRate.cpp))ã€å¤šãã®ç”¨é€”ã§ååˆ†ãªé€Ÿåº¦ã§ã¯ãªã„ã‹ã¨æ€ã„ã¾ã™ã€‚

å˜è‰²ã§ãƒ”ã‚¯ã‚»ãƒ«æ•°ã‚‚å°‘ãªã„ã®ã§è¤‡é›‘ãªã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯æç”»ã«ã¯å‘ãã¾ã›ã‚“ãŒã€ãƒ†ã‚­ã‚¹ãƒˆå‡ºåŠ›ã«ã¯æœ€é©ã§ã™ã€‚ä»Šå›ã® Terminal ã®è¡¨ç¤ºå…ˆã«ã¯ TFT LCD ã«åŠ ãˆã¦ã“ã® OLED ã‚‚å¯¾è±¡ã«ã—ã¦ã„ãã¾ã™ã€‚

## å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

### é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

Visual Studio Code ã‚„ Git ãƒ„ãƒ¼ãƒ«ã€Pico SDK ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒæ¸ˆã‚“ã§ã„ãªã„æ–¹ã¯[ã€ŒPico SDK ã“ã¨ã¯ã˜ã‚ã€](https://zenn.dev/ypsitau/articles/2025-01-17-picosdk#%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83) ã‚’ã”è¦§ãã ã•ã„ã€‚

**pico-jxglib** ã¯ GitHub ã‹ã‚‰ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã™ã‚‹ã“ã¨ã§å…¥æ‰‹ã§ãã¾ã™ã€‚
```
git clone https://github.com/ypsitau/pico-jxglib.git
cd pico-jxglib
git submodule update --init
```

:::message
**pico-jxglib** ã¯ã»ã¼æ¯æ—¥æ›´æ–°ã•ã‚Œã¦ã„ã¾ã™ã€‚ã™ã§ã«ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¦ã„ã‚‹å ´åˆã¯ã€`pico-jxglib` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦æœ€æ–°ã®ã‚‚ã®ã«ã—ã¦ãã ã•ã„ã€‚

```
git pull
```
:::

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

VSCode ã®ã‚³ãƒãƒ³ãƒ‰ãƒ‘ãƒ¬ãƒƒãƒˆã‹ã‚‰ `>Raspberry Pi Pico: New Pico Project` ã‚’å®Ÿè¡Œã—ã€ä»¥ä¸‹ã®å†…å®¹ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚Pico SDK ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆã®è©³ç´°ã‚„ã€ãƒ“ãƒ«ãƒ‰ã€ãƒœãƒ¼ãƒ‰ã¸ã®æ›¸ãè¾¼ã¿æ–¹æ³•ã«ã¤ã„ã¦ã¯[ã€ŒPico SDK ã“ã¨ã¯ã˜ã‚ã€](https://zenn.dev/ypsitau/articles/2025-01-17-picosdk#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90%E3%81%A8%E7%B7%A8%E9%9B%86) ã‚’å‚ç…§ãã ã•ã„ã€‚

- **Name** ... ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’å…¥åŠ›ã—ã¾ã™ã€‚ä»Šå›ã¯ä¾‹ã¨ã—ã¦ `termtest` ã‚’å…¥åŠ›ã—ã¾ã™
- **Board type** ... ãƒœãƒ¼ãƒ‰ç¨®åˆ¥ã‚’é¸æŠã—ã¾ã™
- **Location** ... ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œã‚‹ä¸€ã¤ä¸Šã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’é¸æŠã—ã¾ã™
- **Stdio support** .. Stdio ã«æ¥ç¶šã™ã‚‹ãƒãƒ¼ãƒˆ (UART ã¾ãŸã¯ USB) ã‚’é¸æŠã—ã¾ã™
- **Code generation options** ... **`Generate C++ code` ã«ãƒã‚§ãƒƒã‚¯ã‚’ã¤ã‘ã¾ã™**

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ `pico-jxglib` ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ç½®ãŒä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã¨æƒ³å®šã—ã¾ã™ã€‚

```
+-[pico-jxglib]
+-[termtest]
  +-CMakeLists.txt
  +-termtest.cpp
  +- ...
```

ä»¥ä¸‹ã€ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚‚ã¨ã« `CMakeLists.txt` ã¨ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¦ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚

### TFT LCD ST7789 ä¸Šã§ Terminal

TFT LCD ST7789 ã‚’ä½¿ã£ã¦ Terminal æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã¿ã¾ã™ã€‚ä»–ã®ãƒ‡ãƒã‚¤ã‚¹ã‚’æ¥ç¶šã™ã‚‹å ´åˆã¯[ã€Œpico-jxblib ã¨ TFT LCD ã®è©±ã€](https://zenn.dev/ypsitau/articles/2025-01-27-tft-lcd) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

ãƒ–ãƒ¬ãƒƒãƒ‰ãƒœãƒ¼ãƒ‰ã®é…ç·šã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ãªã©ã®æ“ä½œç”¨ã«ã‚¿ã‚¯ãƒˆã‚¹ã‚¤ãƒƒãƒã‚’é…ç½®ã—ã¦ã„ã¾ã™ã€‚

![circuit-st7789-Terminal.png](/images/2025-02-19-terminal/circuit-st7789-Terminal.png)

`CMakeLists.txt` ã®æœ€å¾Œã«ä»¥ä¸‹ã®è¡Œã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

```cmake:CMakeLists.txt
target_link_libraries(termtest jxglib_ST7789)
add_subdirectory(${CMAKE_CURRENT_LIST_DIR}/../pico-jxglib pico-jxglib)
```

ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¾ã™ã€‚

```cpp:termtest.cpp
#include <stdio.h>
#include "pico/stdlib.h"
#include "jxglib/ST7789.h"
#include "jxglib/Font/shinonome16-japanese-level2.h"
#include "jxglib/sample/Text_Botchan.h"

using namespace jxglib;

Display::Terminal terminal;

int main()
{
    ::stdio_init_all();
    ::spi_init(spi1, 125 * 1000 * 1000);
    GPIO14.set_function_SPI1_SCK();
    GPIO15.set_function_SPI1_TX();
    GPIO18.init().pull_up();
    GPIO19.init().pull_up();
    GPIO20.init().pull_up();
    GPIO21.init().pull_up();
    ST7789 display(spi1, 240, 320, {RST: GPIO10, DC: GPIO11, CS: GPIO12, BL: GPIO13});
    display.Initialize(Display::Dir::Rotate90);
    terminal.AttachDisplay(display);
    terminal.SetFont(Font::shinonome16).SetSpacingRatio(1., 1.2).ClearScreen();
    terminal.Suppress();
    terminal.Print(Text_Botchan);
    terminal.Suppress(false);
    for (int i = 1; i < 7; i++) {
        for (int j = 1; j < 13; j++) terminal.Printf("%3d", i * j);
        terminal.Println();
    }
    for (;;) {
        if (!GPIO18.get()) terminal.RollUp();
        if (!GPIO19.get()) terminal.RollDown();
        if (!GPIO20.get()) terminal.Dump.Cols(8).Ascii()(reinterpret_cast<const void*>(0x10000000), 64);
        if (!GPIO21.get()) terminal.CreateReader().WriteTo(stdout);
        ::sleep_ms(100);
    }
}
```

![termtest-ST7789.jpg](/images/2025-02-19-terminal/termtest-ST7789.jpg)

ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å‰åŠã§ã¯ SPI ã‚„ TFT LCD ã®åˆæœŸåŒ–ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚

```cpp
terminal.AttachDisplay(display);
terminal.SetFont(Font::shinonome16).SetSpacingRatio(1., 1.2).ClearScreen();
```

`Terminal` ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«å¯¾ã—ã¦ `AttachOutut()` é–¢æ•°ã§ TFT LCD ã‚„ OLED ãªã©ã®ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ãƒ‡ãƒã‚¤ã‚¹ã«ã‚¢ã‚¿ãƒƒãƒã—ã¾ã™ã€‚`SetFont()` ã§è¡¨ç¤ºã™ã‚‹ãƒ•ã‚©ãƒ³ãƒˆã€`SetSpacingRatio()` ã§æ–‡å­—é–“éš”ãŠã‚ˆã³è¡Œé–“éš”ã®è¨­å®šã‚’ã—ã¾ã™ã€‚ã“ã‚Œã§ Terminal ã«æ–‡å­—ã‚’å‡ºåŠ›ã™ã‚‹æº–å‚™ãŒæ•´ã„ã¾ã™ã€‚

```cpp
terminal.Suppress();
terminal.Print(Text_Botchan);
terminal.Suppress(false);
for (int i = 1; i < 7; i++) {
    for (int j = 1; j < 13; j++) terminal.Printf("%3d", i * j);
    terminal.Println();
}
```

`Terminal` ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«å¯¾ã—ã¦ `Print()`ã€`Println()`ã€`Printf()` é–¢æ•°ã‚’å®Ÿè¡Œã—ã¦æ–‡å­—åˆ—ã‚’å‡ºåŠ›ã—ã¾ã™ã€‚`Suppress()` é–¢æ•°ã¯ã€ä¸€æ™‚çš„ã«å®Ÿéš›ã®æç”»å‡¦ç†ã‚’æŠ‘åˆ¶ã—ã¾ã™ã€‚`Suppress(false)` ã§é€šå¸¸ã®æç”»å‡¦ç†ã«æˆ»ã‚Šã¾ã™ã€‚

```cpp
if (!GPIO18.get()) terminal.RollUp();
if (!GPIO19.get()) terminal.RollDown();
```

`RollUp()`ã€`RollDown()` é–¢æ•°ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ãƒ­ãƒ¼ãƒ«ã‚¢ãƒƒãƒ—ãƒ»ãƒ­ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ãŒã§ãã¾ã™ã€‚

```cpp
if (!GPIO20.get()) terminal.Dump.Cols(8).Ascii()(reinterpret_cast<const void*>(0x10000000), 64);
```

`Dump()` é–¢æ•°ã¯ãƒ¡ãƒ¢ãƒªå†…å®¹ã‚’ãƒ€ãƒ³ãƒ—å‡ºåŠ›ã—ã¾ã™ã€‚

```cpp
if (!GPIO21.get()) terminal.CreateReader().WriteTo(stdout);
```

`CreateReader()` é–¢æ•°ã¯ãƒ©ã‚¤ãƒ³ãƒãƒƒãƒ•ã‚¡ã®å†…å®¹ã‚’èª­ã¿å‡ºã™ `Stream` ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆã—ã¾ã™ã€‚ã“ã“ã§ã¯ã€ãã® `Stream` ã«å¯¾ã—ã¦ `WriteTo()` ã‚’å®Ÿè¡Œã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’ stdout ã«å‡ºåŠ›ã—ã¦ã„ã¾ã™ã€‚

### OLED SSD1306 ä¸Šã§ Terminal

ãƒ–ãƒ¬ãƒƒãƒ‰ãƒœãƒ¼ãƒ‰ã®é…ç·šã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

![circuit-ssd1306-Terminal.png](/images/2025-02-19-terminal/circuit-ssd1306-Terminal.png)

`CMakeLists.txt` ã®æœ€å¾Œã«ä»¥ä¸‹ã®è¡Œã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

```cmake:CMakeLists.txt
target_link_libraries(termtest jxglib_SSD1306)
add_subdirectory(${CMAKE_CURRENT_LIST_DIR}/../pico-jxglib pico-jxglib)
```

ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¾ã™ã€‚

```cpp:termtest.cpp
#include <stdio.h>
#include "pico/stdlib.h"
#include "jxglib/SSD1306.h"
#include "jxglib/Font/naga10-japanese-level2.h"
#include "jxglib/sample/Text_Botchan.h"

using namespace jxglib;

Display::Terminal terminal;

int main()
{
    ::stdio_init_all();
    ::i2c_init(i2c0, 400 * 1000);
    GPIO4.set_function_I2C0_SDA().pull_up();
    GPIO5.set_function_I2C0_SCL().pull_up();
    GPIO18.init().pull_up();
    GPIO19.init().pull_up();
    GPIO20.init().pull_up();
    GPIO21.init().pull_up();
    SSD1306 display(i2c0, 0x3c);
    display.Initialize();
    terminal.AttachDisplay(display);
    terminal.SetFont(Font::naga10).SetSpacingRatio(1., 1.).ClearScreen();
    terminal.Suppress();
    terminal.Print(Text_Botchan);
    terminal.Suppress(false);
    for (int i = 1; i < 3; i++) {
        for (int j = 1; j < 8; j++) terminal.Printf("%3d", i * j);
        terminal.Println();
    }
    for (;;) {
        if (!GPIO18.get()) terminal.RollUp();
        if (!GPIO19.get()) terminal.RollDown();
        if (!GPIO20.get()) terminal.Dump.NoAddr().Cols(8)(reinterpret_cast<const void*>(0x10000000), 32);
        if (!GPIO21.get()) terminal.CreateReader().WriteTo(stdout);
        ::sleep_ms(100);
    }
}
```

![termtest-SSD1306.jpg](/images/2025-02-19-terminal/termtest-SSD1306.jpg)

```cpp
::i2c_init(i2c0, 400 * 1000);
GPIO4.set_function_I2C0_SDA().pull_up();
GPIO5.set_function_I2C0_SCL().pull_up();
```

I2C ã®åˆæœŸåŒ–ã¨ã€GPIO ã¸ã®ãƒ”ãƒ³å‰²ã‚Šå½“ã¦ã‚’è¡Œã„ã¾ã™ã€‚

```cpp
SSD1306 display(i2c0, 0x3c);
display.Initialize();
```

OLED ã®åˆæœŸåŒ–ã‚’ã—ã¾ã™ã€‚I2C ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ `0x3c` ã¾ãŸã¯ `0x3d` ã‚’æŒ‡å®šã—ã¾ã™ã€‚

### TFT LCD ILI9341 ä¸Šã§ Terminal (+ LVGL)

Terminal ã«ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã‚’ã‚¢ã‚¿ãƒƒãƒã™ã‚‹éš›ã«æç”»ç¯„å›²ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€è¤‡æ•°ã® Terminal ã‚’è¡¨ç¤ºã—ãŸã‚Šãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã‚’ä»–ã®ç”¨é€”ã¨å…±ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã“ã§ã¯[å‰å›ã®è¨˜äº‹](https://zenn.dev/ypsitau/articles/2025-02-04-lvgl)ã§ã¨ã‚Šã‚ã’ãŸ LVGL ã‚’ Terminal ã¨ã¨ã‚‚ã«çµ„ã¿è¾¼ã‚“ã§ã¿ã¾ã™ã€‚

ãƒ–ãƒ¬ãƒƒãƒ‰ãƒœãƒ¼ãƒ‰ã®é…ç·šã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚ILI9341 ã¯ã‚¿ãƒƒãƒã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚’æŒã£ã¦ã„ã‚‹ã®ã§ã€LVGL ã‚’ä½¿ã£ãŸãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ä¸Šã®ãƒœã‚¿ãƒ³ã§ã‚¿ã‚¯ãƒˆã‚¹ã‚¤ãƒƒãƒã®å½¹ç›®ã‚’ã•ã›ã¾ã™ã€‚

![circuit-ili9341-touch.png](/images/2025-02-19-terminal/circuit-ili9341-touch.png)


`CMakeLists.txt` ã®æœ€å¾Œã«ä»¥ä¸‹ã®è¡Œã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

```cmake:CMakeLists.txt
target_link_libraries(termtest jxglib_ILI9341 jxglib_LVGL)
add_subdirectory(${CMAKE_CURRENT_LIST_DIR}/../pico-jxglib pico-jxglib)
jxglib_configure_LVGL(termtest LV_FONT_MONTSERRAT_14)
```

ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¾ã™ã€‚

```cpp:termtest.cpp
#include <stdio.h>
#include <examples/lv_examples.h>
#include "pico/stdlib.h"
#include "jxglib/ILI9341.h"
#include "jxglib/LVGL.h"
#include "jxglib/Font/shinonome12-japanese-level2.h"
#include "jxglib/sample/Text_Botchan.h"

using namespace jxglib;

Display::Terminal terminal;

void OnValueChanged_btnm(lv_event_t* e);

int main()
{
    ::stdio_init_all();
    ::spi_init(spi0, 2 * 1000 * 1000);		// for touch screens
    ::spi_init(spi1, 125 * 1000 * 1000);	// for displays
    GPIO2.set_function_SPI0_SCK();
    GPIO3.set_function_SPI0_TX();
    GPIO4.set_function_SPI0_RX();
    GPIO14.set_function_SPI1_SCK();
    GPIO15.set_function_SPI1_TX();
    ILI9341 display(spi1, 240, 320, {RST: GPIO10, DC: GPIO11, CS: GPIO12, BL: GPIO13});
    ILI9341::TouchScreen touchScreen(spi0, {CS: GPIO8, IRQ: GPIO9});
    display.Initialize(Display::Dir::Rotate0);
    touchScreen.Initialize(display);
    //-----------------------------------------
    terminal.AttachDisplay(display, {0, 0, 240, 220});
    terminal.SetFont(Font::shinonome12).SetSpacingRatio(1., 1.2);
    terminal.Suppress().Print(Text_Botchan);
    terminal.Suppress(false);
    //-----------------------------------------
    LVGL::Initialize();
    LVGL::Adapter lvglAdapter;
    lvglAdapter.AttachDisplay(display, {0, 220, 240, 100});
    lvglAdapter.AttachTouchScreen(touchScreen);
    do {
        static const char* labelTbl[] = {
            "Roll Up", "Dump", "\n",
            "Roll Down", "Print Buffer", "",
        };
        lv_obj_t* btnm = ::lv_buttonmatrix_create(lv_screen_active());
        ::lv_obj_set_size(btnm, 230, 90);
        ::lv_obj_align(btnm, LV_ALIGN_BOTTOM_MID, 0, -5);
        ::lv_obj_add_event_cb(btnm, OnValueChanged_btnm, LV_EVENT_VALUE_CHANGED, nullptr);
        ::lv_obj_remove_flag(btnm, LV_OBJ_FLAG_CLICK_FOCUSABLE);
        ::lv_buttonmatrix_set_map(btnm, labelTbl);
    } while (0);
    for (;;) {
        ::sleep_ms(5);
        ::lv_timer_handler();
    }
}

void OnValueChanged_btnm(lv_event_t* e)
{
    enum class Id {
        RollUp, Dump,
        RollDown, PrintBuffer,
    };
    lv_obj_t* btnm = reinterpret_cast<lv_obj_t*>(::lv_event_get_target(e));
    Id id = static_cast<Id>(::lv_buttonmatrix_get_selected_button(btnm));
    if (id == Id::RollUp) terminal.RollUp();
    if (id == Id::RollDown) terminal.RollDown();
    if (id == Id::Dump) terminal.Dump.Cols(8).Ascii()(reinterpret_cast<const void*>(0x10000000), 64);
    if (id == Id::PrintBuffer) terminal.CreateReader().WriteTo(stdout);
}
```

![termtest-ILI9341.jpg](/images/2025-02-19-terminal/termtest-ILI9341.jpg)

`Terminal` ã®ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã¸ã®ã‚¢ã‚¿ãƒƒãƒæŒ‡å®šã¨:

```cpp
terminal.AttachDisplay(display, {0, 0, 240, 220});
```

`LVGLAdapter` ã®ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã¸ã®ã‚¢ã‚¿ãƒƒãƒæŒ‡å®šã§:

```cpp
lvglAdapter.AttachDisplay(display, {0, 220, 240, 100});
```

ãã‚Œãã‚Œã®æç”»ç¯„å›²ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚

### è¤‡æ•°ã® Terminal ç”Ÿæˆ

`Terminal` ã‚’è¤‡æ•°ç”Ÿæˆã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ ([ãƒ—ãƒ­ã‚°ãƒ©ãƒ ](https://github.com/ypsitau/pico-jxglib/blob/main/Terminal/test-Multi/test-Multi.cpp))ã€‚

![termtest-Multi.jpg](/images/2025-02-19-terminal/termtest-Multi.jpg)

ãã‚Œãã‚Œç‹¬ç«‹ã—ã¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãªã©ã®æ“ä½œã‚’è¡Œãˆã‚‹ã®ã§ã€æ§˜ã€…ãªæƒ…å ±ã‚’ä¸€ã¤ã®ç”»é¢ã§è¡¨ç¤ºã™ã‚‹ã®ã«ä¾¿åˆ©ã§ã™ã€‚

---
title: "プログラム不要! コマンド操作で Pico ボードと OV7670 カメラを簡単接続"
emoji: "📷"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["raspberrypi", "raspberrypipico", "ov7670", "camera", "pico"]
published: false
---
[pico-jxgLABO](https://zenn.dev/ypsitau/articles/2025-08-01-labo-intro) は、USB ケーブル一本でマイコンボード RaspberryPi Pico の様々な機能を試すことができる実験プラットフォームです。

pico-jxgLABO に OV7670 カメラモジュール (FIFO メモリ無し) のサポートを追加しました。

OV7670 はとてもポピュラーなカメラモジュールで、一個 500 程度で購入できる手軽さから多くの電子工作プロジェクトで利用されています。でも、汎用的に実装されたものはそれほど多くなく、自分のプロジェクトに組み込むには工夫が必要です。

pico-jxgLABO では、コマンド操作で OV7670 カメラモジュールをセットアップできるようにしました。これにより、プログラムを作成しなくてもカメラの動作確認や実験が簡単に行えます。

この記事では、カメラモジュールを使った以下の実験を行います。

- Pico ボードと USB で接続されたホスト PC (Windows) でカメラアプリを起動して、OV7670 カメラモジュールからの動画ストリーミングを行います。OV7670 カメラモジュールと Pico ボード (+ ホスト PC) だけでできる実験です。
- TFT LCD ディスプレイモジュール ST7789 を追加し、カメラ画像をこのディスプレイにリアルタイム表示します。

なお、開発や動作確認をするホスト PC は Windows を想定しています。

## OV7670 カメラモジュールについて

OV7670 (FIFO メモリ無し) は、Omnivision が開発した VGA 解像度 (640x480) のカメラモジュールです。I2C インターフェースを使用してレジスタ設定を行い、クロックで同期を取りながら 8 ビットのパラレルデータバスで画像データを出力します。

![ov7670.jpg](https://raw.githubusercontent.com/ypsitau/zenn/main/images/2025-12-22-labo-ov7670/ov7670.jpg)

OV7670 カメラモジュールの信号は以下の通りです。

|信号名|説明|
|---|---|
|D0-D7|8 ビットのパラレルデータバス|
|XCLK|外部クロック入力。通常 24 MHz の方形波を供給します|
|PCLK|ピクセルクロック出力。1 ピクセルごとにパルスを出力します|
|HREF|水平同期信号。この信号がアクティブの間、ピクセルデータが有効です|
|VSYNC|垂直同期信号。フレームの開始を示します|
|SDA|I2C データライン|
|SCL|I2C クロックライン|

レジスタの仕様などを記載したデータシートは、開発元のサイトには見当たりません。僕が参照したのは以下のリンク先の PDF ファイルです。特に、Implementation Guide は、混沌としたレジスタ群を機能ごとにカテゴリー分けしており、動作を理解するための参考になります。

- [OV7670_2026](https://web.mit.edu/6.111/www/f2016/tools/OV7670_2006.pdf)
- [OV7670 Implementation Guide (V1.0)](https://www.haoyuelectronics.com/Attachment/OV7670%20+%20AL422B(FIFO)%20Camera%20Module(V2.0)/OV7670%20Implementation%20Guide%20(V1.0).pdf)

これらのドキュメントは OV7670 の仕様をすべて網羅しているわけではなく、重要な情報が欠落しています。特に、デフォルトの状態ではモノクロ画像しか取得できず、カラー画像を取得するにはレジスタの設定が必要なのですが、この操作は「レジスタ `0xB0` に `0x84` を設定する」というものになります。でも、これが何を意味するのかはドキュメントに記載されておらず不明です。実際に動作するコードを作成するには、有志が開発したプログラムを参考にしながら試行錯誤で実装をすすめる必要があります。

## pico-jxgLABO の書き込み

Pico ボードへの pico-jxgLABO の書き込みと基本的な使い方は[こちら](https://zenn.dev/ypsitau/articles/2025-08-01-labo-intro#pico-jxglabo-%E3%81%AE%E5%B0%8E%E5%85%A5%E6%96%B9%E6%B3%95)。特別なハードウェアは必要なく、Pico や Pico 2 ボードを USB ケーブルで PC に接続するだけで始められます。ターミナルソフトを使ってコマンドを入力し、Pico ボードを操作します。

この記事で説明する実験を行うには、バージョン **0.6.2** 以降の pico-jxgLABO が Pico ボードに書き込まれている必要があります。ターミナルソフトで `about-me` コマンドを実行すると pico-jxgLABO のバージョンを確認できます。

```text
L:/>about-me
Program Information
 name:              pico-jxgLABO
 version:           0.6.2
     :
     :
```

## OV7670 カメラモジュールの接続

OV7670 カメラモジュールは、I2C インターフェースと複数の GPIO ピンを使用して Pico ボードに接続します。以下の配線例を参考にしてください。

![ov7670-wiring.png](https://raw.githubusercontent.com/ypsitau/zenn/main/images/2025-12-22-labo-ov7670/ov7670-wiring.png)

接続する GPIO ピンはコマンドでカスタマイズができます。以下の点に留意してください。

- D0 から D7 までの 8 本のデータラインは連続した GPIO ピンに接続する必要があります
- SDA と SCL は Pico ボードの I2C0 またｈ I2C1 のいずれかの I2C インターフェースに接続します
- XCLK, PCLK, HREF, VSYNC は任意の GPIO ピンに接続できます

最も周波数の高い XCLK 端子には 24 MHz の信号が供給されるので、配線はできるだけ短くすることが望ましいです。とはいうものの、それほど神経質になる必要もないようで、手元の実験では 16 cm 程度のジャンパーワイヤーで接続して問題なく動作しています。

![ov7670-wiring-photo.jpg](https://raw.githubusercontent.com/ypsitau/zenn/main/images/2025-12-22-labo-ov7670/ov7670-wiring-photo.jpg)
*OV7670 カメラモジュールと Pico ボードの接続例*

以下のコマンドを実行して、I2C インターフェースとカメラモジュールをセットアップします。

```text
L:>i2c0 -p 16,17 --baudrate:100000
L:>camera-ov7670 setup {i2c:0 d0:2 xclk:10 pclk:11 href:12 vsync:13}
```

- `i2c0` コマンドで I2C0 インターフェースを GPIO16 (SDA), GPIO17 (SCL) に設定し、通信速度を 100 kHz に指定しています
- `camera-ov7670 setup` コマンドで OV7670 カメラモジュールの各種接続ピンを指定しています。I2C インターフェースとして i2c0 を選択しています。D0 は GPIO2 に接続し、D1 から D7 までは連続した GPIO3 から GPIO9 に自動的に割り当てられます。XCLK, PCLK, HREF, VSYNC はそれぞれ GPIO10, GPIO11, GPIO12, GPIO13 に接続しています。

これで、OV7670 カメラモジュールが使用可能になります。`camera-ov7670` コマンドで `dump` サブコマンドを実行して、カメラモジュールのレジスタ設定を確認してみましょう。

```text
L:/>camera-ov7670 dump
00  3C 80 80 00 01 0B 61 40 9D 00 76 73 04 00 01 02
10  7F 01 04 EF 20 02 00 11 61 03 7B 00 7F A2 04 00
20  04 02 01 00 75 63 A5 80 80 07 00 00 80 00 00 61
30  08 30 80 08 11 1A 00 3F 01 00 00 08 68 C0 19 00
40  11 08 00 14 F0 45 61 51 79 00 00 01 00 00 00 80
50  80 00 22 5E 80 00 40 80 1E 00 00 01 00 00 00 F0
60  F0 F0 00 00 04 20 05 80 80 01 80 4A 0A 55 11 9A
70  3A 35 11 F1 11 0F C1 10 00 00 20 1C 28 3C 55 68
80  76 80 88 8F 96 A3 AF C4 D7 E8 00 00 00 0F 00 00
90  00 00 00 00 04 08 01 01 10 40 40 20 00 99 7F 78
A0  68 03 02 00 00 05 DF DF F0 90 94 07 00 00 00 00
B0  84 04 00 82 00 20 00 66 00 06 00 00 00 00 00 00
C0  00 00 00 00 00 00 00 00 06 CE
```

### ホスト PC への動画ストリーミング

Pico ボードと USB で接続されたホスト PC (Windows) でカメラアプリを起動して、OV7670 カメラモジュールからの動画ストリーミングを表示してみましょう。

1. ホスト PC と Pico ボードを USB ケーブルで接続します。

2. Pico ボードの `L:` ドライブのルートディレクトリに `.startup` ファイルを作成し、以下の内容を記述して保存します。`L:` ドライブは、ホスト PC からは USB マスストレージデバイスとして認識されるので、ホスト PC 上のテキストエディタで作成できます。

   ```text:.startup
   usbdev-video-transmitter setup
   ```

   USB ケーブルを抜き差しして、Pico ボードを再起動します。これにより、Pico ボードが USB ビデオデバイスとして認識されます。

3. ホスト PC で、タスクバーの検索ボックスに「カメラ」と入力してカメラアプリを起動します。正常に認識されていると、起動時に以下のように "pico-jxgLABO VideoTransmitter" と表示されます。

   ![windows-camera-app.png](https://raw.githubusercontent.com/ypsitau/zenn/main/images/2025-12-22-labo-ov7670/windows-camera-app.png)

   PC に複数のカメラデバイスが接続されている場合は、下図のように右上にカメラ選択ボタンが表示されるので、"pico-jxgLABO VideoTransmitter" が表示される画面に切り替えます。

   ![windows-camera-app-select.png](https://raw.githubusercontent.com/ypsitau/zenn/main/images/2025-12-22-labo-ov7670/windows-camera-app-select.png)


4. ターミナルで以下のコマンドを実行して、OV7670 カメラモジュールからホスト PC に動画ストリーミングを開始します。

   ```text
   L:>camera transmit-video-start
   ```

   カメラアプリの画面に OV7670 カメラモジュールからの映像が表示されれば成功です。

   ![windows-camera-app-ov7670.png](https://raw.githubusercontent.com/ypsitau/zenn/main/images/2025-12-22-labo-ov7670/windows-camera-app-ov7670.png)

### TFT ディスプレイへのリアルタイム表示

ST7789 TFT ディスプレイモジュールにカメラからのイメージをリアルタイム表示します。

1. 以下の配線例を参考にして、OV7670 カメラモジュールと ST7789 TFT ディスプレイモジュールを Pico ボードに接続します。

   ![ov7670-st7789-wiring.png](https://raw.githubusercontent.com/ypsitau/zenn/main/images/2025-12-22-labo-ov7670/ov7670-st7789-wiring.png)

2. 以下のコマンドを実行して、OV7670 カメラモジュールと ST7789 TFT ディスプレイモジュールをセットアップします。

   ```text
   L:>i2c0 -p 16,17 --baudrate:100000
   L:>camera-ov7670 setup {i2c:0 d0:2 xclk:10 pclk:11 href:12 vsync:13}
   L:>spi1 -p 14,15 --baudrate:50000000
   L:>display-st7789 setup {spi:1 rst:18 dc:19 cs:20 bl:21 dir:rotate90}
   ```

   以下のコマンドを実行して、ディスプレイモジュールの画面全体が赤色になればディスプレイの接続に成功しています。

   ```text
   L:>draw fill {color:red}
   ```

3. `camera` コマンドの `display-start` サブコマンドを実行すると、OV7670 カメラの映像を TFT ディスプレイにリアルタイム表示します。

   ```text
   L:>camera display-start
   ```

   ![ov7670-st7789-wiring-photo.jpg](https://raw.githubusercontent.com/ypsitau/zenn/main/images/2025-12-22-labo-ov7670/ov7670-st7789-wiring-photo.jpg)

### 各種パラメータの設定

`camera-ov7670` コマンドでは、サブコマンドを使って以下のような各種パラメータを設定できます。

- `mirror`: ミラー表示 (左右反転) の有効/無効を設定します

  ```text
  L:>camera-ov7670 mirror:on
  ```

- `vflip`: 上下反転の有効/無効を設定します

  ```text
  L:>camera-ov7670 vflip:on
  ```

- `brightness`: 明るさ調整の値を設定します (-127 から +127

  ```text
  L:>camera-ov7670 brightness:2
  ```

- `contrast`: コントラスト調整の値を設定します (0 から 255)

  ```text
  L:>camera-ov7670 contrast:2
  ```

- `sharpness`: シャープネス調整の値を設定します (0 から 31)

  ```text
  L:>camera-ov7670 sharpness:2
  ```

### まとめ

OV7670 カメラモジュールを pico-jxgLABO で簡単にセットアップし、画像キャプチャ、動画ストリーミング、TFT ディスプレイへのリアルタイム表示を行う方法を紹介しました。これにより、Raspberry Pi Pico を使ったカメラアプリケーションの開発が手軽に始められます。ぜひ試してみてください！
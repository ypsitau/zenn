---
title: "pico-jxglib ã§ Pico ãƒœãƒ¼ãƒ‰ã« RTC ã‚’æ¥ç¶šã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’è¨˜éŒ²ã™ã‚‹è©±"
emoji: "ğŸ™Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["çµ„ã¿è¾¼ã¿", "raspberrypi", "pico", "raspberrypipico", "rtc"]
published: true
---
**pico-jxglib** ã¯ã€ãƒ¯ãƒ³ãƒœãƒ¼ãƒ‰ãƒã‚¤ã‚³ãƒ³ Raspberry Pi Pico ã® Pico SDK ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚

https://zenn.dev/ypsitau/articles/2025-01-24-jxglib-intro

ä»Šå›ã¯ã€Pico ãƒœãƒ¼ãƒ‰ã« RTC ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’æ¥ç¶šã—ã¦ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’è¨˜éŒ²ã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

## RTC ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ã¤ã„ã¦

RTCï¼ˆReal-Time Clockï¼‰ã¯ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã®æ—¥æ™‚ã‚’ä¿æŒã™ã‚‹ãŸã‚ã®ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã§ã™ã€‚åˆä»£ Pico (RP2040) ã«ã¯ãƒãƒƒãƒ—å†…ã« RTC ãŒå†…è”µã•ã‚Œã¦ã„ã¦ã€ã€ŒãŠã€ã“ã‚Œã§å¤–ä»˜ã‘ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ãªã—ã«æ—¥æ™‚æƒ…å ±ã‚’å¾—ã‚‰ã‚Œã‚‹ãã€ã¨ã¡ã‚‡ã£ã¨è‰²ã‚ãã ã¤ã®ã§ã™ãŒã€æ®‹å¿µãªãŒã‚‰é›»æºã‚’åˆ‡ã‚‹ã¨æ—¥æ™‚æƒ…å ±ãŒå¤±ã‚ã‚Œã¦ã—ã¾ã†ã®ã§ã€ã‚ã¾ã‚Šå®Ÿç”¨çš„ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ä½•ã«ã›ã‚ˆã€å¾Œç¶™ã® Pico2 (RP2350) ã§ã¯ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒå–ã‚Šé™¤ã‹ã‚Œã¦ã—ã¾ã£ãŸã®ã§ã€å®Ÿä½¿ç”¨ã®å€™è£œã«ã¯ãªã‚‰ãªã„ã§ã—ã‚‡ã†ã€‚

RTC ã‚’ä½¿ã†ç¾å®Ÿè§£ã¨ã—ã¦ã¯ã€Pico ãƒœãƒ¼ãƒ‰ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—é›»æ± ã‚’è£…å‚™ã—ãŸ RTC ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’æ¥ç¶šã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ï½“ã€‚ã“ã‚Œã§ Pico ãƒœãƒ¼ãƒ‰ã®é›»æºçŠ¶æ…‹ã«ã‹ã‹ã‚ã‚‰ãšæ—¥æ™‚æƒ…å ±ã‚’ä¿æŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

é›»å­å·¥ä½œã§ã‚ˆãä½¿ã‚ã‚Œã¦ã„ã‚‹ RTC ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã„ã†ã¨ã€I2C ã§æ¥ç¶šãŒã§ãã‚‹ DS3231 ãŒã‚ˆãæŒ™ã’ã‚‰ã‚Œã¾ã™ã€‚DS1307 ã¨ã„ã†å»‰ä¾¡ç‰ˆã‚‚ã‚ã‚Šã¾ã™ãŒã€ä¸€æ—¥ã«æ•°ç§’ã‚‚ãšã‚Œã‚‹ã‚‰ã—ã„ã®ã§ã€ã‚ãšã‹ãªä¾¡æ ¼å·®ã§é«˜ç²¾åº¦ãª DS3231 ã‚’ä½¿ã†ã®ãŒè‰¯ã„ã§ã—ã‚‡ã†ã€‚

åƒ•ãŒ Amazon ã§è³¼å…¥ã—ãŸ DS3231 ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚‚ã®ã§ã™ã€‚

![rtc-ds3231](/images/2025-06-22-rtc/rtc-ds3231.jpg)

ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—é›»æ± ãŒåˆã‚ã‹ã‚‰è£…å‚™ã•ã‚Œã¦ã„ã¾ã™ã—ã€ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãªå½¢çŠ¶ã‚’ã—ã¦ã„ã‚‹ã®ãŒè‰¯ã„æ„Ÿã˜ã§ã™ã€‚åŸºæ¿ã«å°åˆ·ã•ã‚Œã¦ã„ã‚‹ä¿¡å·åãŒåˆ†ã‹ã‚Šã¥ã‚‰ã„ã®ã§ã™ãŒã€`+` = `VCC`ã€`D` = `SDA`ã€`C` = `SCL`ã€`-` = `GND` ã¨ãªã£ã¦ã„ã¾ã™ã€‚

ä»Šå›ã®è¨˜äº‹ã§ã¯ã€ã“ã® DS3231 ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ Pico ãƒœãƒ¼ãƒ‰ã«æ¥ç¶šã—[^ds1307:]ã€RTC ã‚’ä½¿ã£ãŸä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

[^ds1307:]: DS1307 ã‚‚ I2C ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚„ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãªã©ãŒ DS3231 ã¨å…±é€šã—ã¦ã„ã‚‹ã®ã§ã€åŒã˜ã‚ˆã†ã«æ‰±ã†ã“ã¨ãŒã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚

- ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’è¨˜éŒ²ã™ã‚‹
- ã‚·ã‚§ãƒ«ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«æ—¥æ™‚ã‚’è¡¨ç¤ºã™ã‚‹
- æ™‚è¨ˆã‚¢ãƒ—ãƒªã‚’ä½œæˆã™ã‚‹

### å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

### é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

Visual Studio Code ã‚„ Git ãƒ„ãƒ¼ãƒ«ã€Pico SDK ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒæ¸ˆã‚“ã§ã„ãªã„æ–¹ã¯[ã€ŒPico SDK ã“ã¨ã¯ã˜ã‚ã€](https://zenn.dev/ypsitau/articles/2025-01-17-picosdk#%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83) ã‚’ã”è¦§ãã ã•ã„ã€‚

GitHub ã‹ã‚‰ **pico-jxglib** ã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¾ã™ã€‚

```text
git clone https://github.com/ypsitau/pico-jxglib.git
cd pico-jxglib
git submodule update --init
```

:::message
**pico-jxglib** ã¯ã»ã¼æ¯æ—¥æ›´æ–°ã•ã‚Œã¦ã„ã¾ã™ã€‚ã™ã§ã«ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¦ã„ã‚‹å ´åˆã¯ã€`pico-jxglib` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦æœ€æ–°ã®ã‚‚ã®ã«ã—ã¦ãã ã•ã„ã€‚

```text
git pull
```

:::

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

VSCode ã®ã‚³ãƒãƒ³ãƒ‰ãƒ‘ãƒ¬ãƒƒãƒˆã‹ã‚‰ `>Raspberry Pi Pico: New Pico Project` ã‚’å®Ÿè¡Œã—ã€ä»¥ä¸‹ã®å†…å®¹ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚Pico SDK ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆã®è©³ç´°ã‚„ã€ãƒ“ãƒ«ãƒ‰ã€ãƒœãƒ¼ãƒ‰ã¸ã®æ›¸ãè¾¼ã¿æ–¹æ³•ã«ã¤ã„ã¦ã¯[ã€ŒPico SDK ã“ã¨ã¯ã˜ã‚ã€](https://zenn.dev/ypsitau/articles/2025-01-17-picosdk#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90%E3%81%A8%E7%B7%A8%E9%9B%86) ã‚’å‚ç…§ãã ã•ã„ã€‚

- **Name** ... ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’å…¥åŠ›ã—ã¾ã™ã€‚ä»Šå›ã¯ä¾‹ã¨ã—ã¦ `rtctest` ã‚’å…¥åŠ›ã—ã¾ã™
- **Board type** ... ãƒœãƒ¼ãƒ‰ç¨®åˆ¥ã‚’é¸æŠã—ã¾ã™
- **Location** ... ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œã‚‹ä¸€ã¤ä¸Šã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’é¸æŠã—ã¾ã™
- **Stdio support** .. ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚½ãƒ•ãƒˆã«æ¥ç¶šã™ã‚‹ãƒãƒ¼ãƒˆ (UART ã¾ãŸã¯ USB) ã‚’é¸æŠã—ã¾ã™
- **Code generation options** ... **`Generate C++ code` ã«ãƒã‚§ãƒƒã‚¯ã‚’ã¤ã‘ã¾ã™**

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ `pico-jxglib` ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ç½®ãŒä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã¨æƒ³å®šã—ã¾ã™ã€‚

```text
â”œâ”€â”€ pico-jxglib/
â””â”€â”€ rtctest/
    â”œâ”€â”€ CMakeLists.txt
    â”œâ”€â”€ rtctest.cpp
    â””â”€â”€ ...
```

ä»¥ä¸‹ã€ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚‚ã¨ã« `CMakeLists.txt` ã‚„ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¦ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚

### ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’è¨˜éŒ²ã™ã‚‹

RTC ã‹ã‚‰æ—¥æ™‚æƒ…å ±ã‚’å–å¾—ã—ã¦ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’è¨˜éŒ²ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ãƒ–ãƒ¬ãƒƒãƒ‰ãƒœãƒ¼ãƒ‰ã®é…ç·šã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

![circuit-rtc](/images/2025-06-22-rtc/circuit-rtc.png)

`CMakeLists.txt` ã®æœ€å¾Œã«ä»¥ä¸‹ã®è¡Œã‚’è¿½åŠ ã—ã¾ã™ã€‚

```cmake:CMakeLists.txt
target_link_libraries(rtctest jxglib_RTC_DS323x jxglib_LFS_Flash jxglib_FAT_Flash jxglib_Serial jxglib_ShellCmd_FS)
add_subdirectory(${CMAKE_CURRENT_LIST_DIR}/../pico-jxglib pico-jxglib)
jxglib_configure_FAT(rtctest FF_VOLUMES 1)
```

ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¾ã™ã€‚

```cpp:rtctest.cpp
#include <stdio.h>
#include "pico/stdlib.h"
#include "jxglib/Serial.h"
#include "jxglib/Shell.h"
#include "jxglib/LFS/Flash.h"
#include "jxglib/FAT/Flash.h"
#include "jxglib/RTC/DS323x.h"

using namespace jxglib;

int main()
{
    ::stdio_init_all();
    LFS::Flash driveA("A:",  0x1010'0000, 0x0004'0000); // Flash address and size 256kB
    LFS::Flash driveB("B:",  0x1014'0000, 0x0004'0000); // Flash address and size 256kB
    LFS::Flash driveC("*C:", 0x1018'0000, 0x0004'0000); // Flash address and size 256kB
    FAT::Flash driveD("D:",  0x101c'0000, 0x0004'0000); // Flash address and size 256kB
    Serial::Terminal terminal;
    Shell::AttachTerminal(terminal.Initialize());
    ::i2c_init(i2c0, 400'000);
    GPIO16.set_function_I2C0_SDA().pull_up();
    GPIO17.set_function_I2C0_SCL().pull_up();
    RTC::DS323x rtc(i2c0);
    for (;;) {
        // :
        // any other jobs
        // :
        Tickable::Tick();
    }
}
```

ã“ã®ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã¯[ã€Œpico-jxglib ã®ã‚·ã‚§ãƒ«ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚’æ“ä½œã™ã‚‹è©± (è‡ªå‹•è£œå®Œã¨ãƒ’ã‚¹ãƒˆãƒªæ©Ÿèƒ½ã§å…¥åŠ›æ¥½ã€…)ã€](https://zenn.dev/ypsitau/articles/2025-06-09-rtctest#%E3%82%B7%E3%82%A7%E3%83%AB%E3%81%A8%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E6%93%8D%E4%BD%9C%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%AE%E7%B5%84%E8%BE%BC%E3%81%BF)ã§ç´¹ä»‹ã—ãŸã‚‚ã®ã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ã¦ãŠã‚Šã€Pico ãƒœãƒ¼ãƒ‰ã®ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒ¢ãƒªä¸Šã« LittleFS ã¨ FAT ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ‰ãƒ©ã‚¤ãƒ–ã‚’ä½œæˆã—ã¾ã™ã€‚I2C ã®åˆæœŸåŒ–ã¨ã€`RTC::DS323x` ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ç”Ÿæˆã‚’è¿½åŠ ã™ã‚‹ã¨ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’è¨˜éŒ²ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ä¸Šã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ã‚·ã‚§ãƒ«ãŒèµ·å‹•ã—ã¾ã™ã€‚ã‚·ã‚§ãƒ«ã®æ“ä½œã¯ UART ã¾ãŸã¯ USB ã§æ¥ç¶šã—ãŸãƒ›ã‚¹ãƒˆ PC ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚½ãƒ•ãƒˆã‹ã‚‰è¡Œã„ã¾ã™ã€‚

RTC ã®æ—¥æ™‚ã‚’è¨­å®šã™ã‚‹ã«ã¯ `rtc` ã‚³ãƒãƒ³ãƒ‰ã‚’æ—¥ä»˜ã‚„æ™‚åˆ»ã‚’å¼•æ•°ã«ã—ã¦å®Ÿè¡Œã—ã¾ã™ã€‚

```text
C:?>rtc 2025-06-22 12:34:56
2025-06-22 12:34:56.000
```

RTC ã®ç¾åœ¨æ—¥æ™‚ã‚’ç¢ºèªã™ã‚‹ã«ã¯ `rtc` ã‚³ãƒãƒ³ãƒ‰ã‚’å¼•æ•°ãªã—ã§å®Ÿè¡Œã—ã¾ã™ã€‚

```text
C:?>rtc
2025-06-22 12:35:32.000
```

ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãŒè¨˜éŒ²ã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã¿ã¾ã™ã€‚æœ€åˆã®çŠ¶æ…‹ã ã¨ãƒ‰ãƒ©ã‚¤ãƒ–ã¯ã¾ã ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚Œã¦ã„ãªã„ã®ã§ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã—ã¦ãã ã•ã„ã€‚

```text
C:?>format a: b: c: d:
drive a: formatted in LittleFS
drive b: formatted in LittleFS
drive c: formatted in LittleFS
drive d: formatted in FAT12
C:/>ls-drive
 Drive  Format           Total
 A:     LittleFS         256K
 B:     LittleFS         256K
*C:     LittleFS         256K
 D:     FAT12            256K
```

`C:` ãƒ‰ãƒ©ã‚¤ãƒ–ã¯ LittleFS ã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®ãƒ‰ãƒ©ã‚¤ãƒ–ä¸Šã« `cat` ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

```text
C:/>cat > test.txt
This is a test file.
^C
```

`ls` ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã¿ã‚‹ã¨:

```text
C:/>ls
-a--- 2025-06-22 12:36:39     21 test.txt
```

ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãŒè¨˜éŒ²ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚LittleFS ã¯ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’æŒãŸãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã§ã™ãŒã€**pico-jxglib** ã§ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆé ˜åŸŸã« 64 ãƒ“ãƒƒãƒˆ UNIX æ™‚åˆ»ã®å½¢å¼ã§æ—¥æ™‚æƒ…å ±ã‚’è¨˜éŒ²ã—ã¦ã„ã¾ã™ã€‚

`touch` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã†ã¨ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’æ›´æ–°ã§ãã¾ã™ã€‚

```text
C:/>touch test.txt
C:/>ls
-a--- 2025-06-22 12:37:38     21 test.txt
```

### ã‚·ã‚§ãƒ«ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«æ—¥æ™‚ã‚’è¡¨ç¤ºã™ã‚‹

ã‚·ã‚§ãƒ«ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«æ—¥æ™‚ã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãƒ–ãƒ¬ãƒƒãƒ‰ãƒœãƒ¼ãƒ‰ã®é…ç·šã¨ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯å‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¨åŒã˜ã§ã™ã€‚

ã‚·ã‚§ãƒ«ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å¤‰æ›´ã™ã‚‹ã«ã¯ `prompt` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚`%Y` ã‚„ã€€`%M` ãªã©ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ–‡å­—åˆ—ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€æ—¥æ™‚ã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```text
C:/>prompt "%Y-%M-%D %h:%m:%s>"
2025-06-22 12:45:07>
2025-06-22 12:45:08>
2025-06-22 12:45:13>
2025-06-22 12:45:14>
```

### æ™‚è¨ˆã‚¢ãƒ—ãƒªã‚’ä½œæˆã™ã‚‹

RTC ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‹ã‚‰æ—¥æ™‚æƒ…å ±ã‚’å–å¾—ã—ã¦ã€TFT LCD ST7789 ã«è¡¨ç¤ºã™ã‚‹æ™‚è¨ˆã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¾ã™ã€‚

ãƒ–ãƒ¬ãƒƒãƒ‰ãƒœãƒ¼ãƒ‰ã®é…ç·šã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

![circuit-rtc-st7789](/images/2025-06-22-rtc/circuit-rtc-st7789.png)

`CMakeLists.txt` ã®æœ€å¾Œã«ä»¥ä¸‹ã®è¡Œã‚’è¿½åŠ ã—ã¾ã™ã€‚

```cmake:CMakeLists.txt
target_link_libraries(rtctest jxglib_ST7789 jxglib_RTC_DS323x)
add_subdirectory(${CMAKE_CURRENT_LIST_DIR}/../pico-jxglib pico-jxglib)
```

ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¾ã™ã€‚

```cpp:rtctest.cpp
#include <stdio.h>
#include "pico/stdlib.h"
#include "jxglib/RTC/DS323x.h"
#include "jxglib/ST7789.h"
#include "jxglib/Font/shinonome18.h"

using namespace jxglib;

int main()
{
    stdio_init_all();
    ::spi_init(spi1, 125'000'000);
    GPIO14.set_function_SPI1_SCK();
    GPIO15.set_function_SPI1_TX();
    ST7789 display(spi1, 240, 320, {RST: GPIO10, DC: GPIO11, CS: GPIO12, BL: GPIO13});
    display.Initialize(Display::Dir::Rotate90);
    ::i2c_init(i2c0, 400'000);
    GPIO16.set_function_I2C0_SDA().pull_up();
    GPIO17.set_function_I2C0_SCL().pull_up();
    RTC::DS323x rtc(i2c0);
    DateTime dtPrev;
    for (;;) {
        DateTime dt;
        RTC::Get(&dt);
        if (dt != dtPrev) {
            int ySeparator = display.GetHeight() * 2 / 5;
            dtPrev = dt;
            char str[32];
            display.SetFont(Font::shinonome18).SetFontScale(2, 2).SetColor(Color(192, 192, 192));
            ::snprintf(str, sizeof(str), "%04d-%02d-%02d", dt.year, dt.month, dt.day);
            Size size = display.CalcStringSize(str);
            display.DrawString((display.GetWidth() - size.width) / 2, ySeparator - 8 - size.height, str);
            display.SetFont(Font::shinonome18).SetFontScale(4, 4).SetColor(Color(192, 192, 255));
            ::snprintf(str, sizeof(str), "%02d:%02d:%02d", dt.hour, dt.min, dt.sec);
            size = display.CalcStringSize(str);
            display.DrawString((display.GetWidth() - size.width) / 2, ySeparator + 8, str);
            display.Refresh();
        }
        Tickable::Tick();
    }
}
```

![clock-app](/images/2025-06-22-rtc/clock-app.jpg)

### ãŠã¾ã‘: Pico ã® RTC ã‚’åˆ©ç”¨ã™ã‚‹

`RTC::Pico` ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã§ã€Pico ãƒœãƒ¼ãƒ‰ã®å†…è”µ RTC ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚åˆä»£ Pico (RP2040) å°‚ç”¨ã§ã™ã€‚Pico2 (RP2350) ã§ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚

`CMakeLists.txt` ã®æœ€å¾Œã«ä»¥ä¸‹ã®è¡Œã‚’è¿½åŠ ã—ã¾ã™ã€‚

```cmake:CMakeLists.txt
target_link_libraries(rtctest jxglib_RTC_Pico jxglib_LFS_Flash jxglib_FAT_Flash jxglib_Serial jxglib_ShellCmd_FS)
add_subdirectory(${CMAKE_CURRENT_LIST_DIR}/../pico-jxglib pico-jxglib)
jxglib_configure_FAT(rtctest FF_VOLUMES 1)
```

ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¾ã™ã€‚

```cpp:rtctest.cpp
#include <stdio.h>
#include "pico/stdlib.h"
#include "jxglib/Serial.h"
#include "jxglib/Shell.h"
#include "jxglib/LFS/Flash.h"
#include "jxglib/FAT/Flash.h"
#include "jxglib/RTC/Pico.h"

using namespace jxglib;

int main()
{
    ::stdio_init_all();
    LFS::Flash driveA("A:",  0x1010'0000, 0x0004'0000); // Flash address and size 256kB
    LFS::Flash driveB("B:",  0x1014'0000, 0x0004'0000); // Flash address and size 256kB
    LFS::Flash driveC("*C:", 0x1018'0000, 0x0004'0000); // Flash address and size 256kB
    FAT::Flash driveD("D:",  0x101c'0000, 0x0004'0000); // Flash address and size 256kB
    Serial::Terminal terminal;
    Shell::AttachTerminal(terminal.Initialize());
    RTC::Pico rtc;
    for (;;) {
        // :
        // any other jobs
        // :
        Tickable::Tick();
    }
}
```

`rtc` ã‚³ãƒãƒ³ãƒ‰ãªã©ã§æ—¥æ™‚ã‚’ç¢ºèªã—ãŸæ™‚ç‚¹ã§ RTC ãŒå‹•ãå§‹ã‚ã¾ã™ã€‚

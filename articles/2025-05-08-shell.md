---
title: "pico-jxglib で pico ボードにシェル機能を実装する話"
emoji: "😺"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["組み込み", "raspberrypi", "pico", "raspberrypipico", "usb"]
published: false
---
**pico-jxglib** は、ワンボードマイコン Raspberry Pi Pico の Pico SDK プログラミングをサポートするライブラリです。

https://zenn.dev/ypsitau/articles/2025-01-24-jxglib-intro

今回は、以前に上げた記事[「pico-jxglib とコマンドライン編集機能の話」](https://zenn.dev/ypsitau/articles/2025-04-06-cmdline-editor)で紹介した Terminal のコマンド入力機能を使って、pico ボードにシェル機能を実装します。

## 

プログラムを走らせている間のレジスタやメモリ、デバイスの状態をモニタしたり、変更したりすることができるようになります。


1. `Terminal` を生成して、`Shell::AttachTerminal()` で shell に接続
1. メインループ中で `Tickable::Tick()` を実行

Linux における bash、Windows における PowerShell のような 

```cpp
ShellCmd(name, "comment")
{
}
```

- `Terminal& terminal` ... `Terminal` インスタンス。
- `int argc` ... 引数の数
- `char** argv` ... 引数文字列。`argv[0]` はコマンド自身の名前が格納されます

シリアルターミナルを使う

```cpp
#include <stdio.h>
#include "pico/stdlib.h"
#include "jxglib/Serial.h"
#include "jxglib/Shell.h"

using namespace jxglib;

int main()
{
    ::stdio_init_all();
    //-------------------------------------------------------------------------
    Serial::Terminal terminal;
    terminal.Initialize();
    Shell::AttachTerminal(terminal);
    //-------------------------------------------------------------------------
    terminal.Println("Shell with Serial Terminal");
    for (;;) Tickable::Tick();
}
```

TFT LCD ST7789 と USB キーボードを使う

```cpp
#include <stdio.h>
#include "pico/stdlib.h"
#include "jxglib/ST7789.h"
#include "jxglib/USBHost.h"
#include "jxglib/Shell.h"
#include "jxglib/Font/shinonome16.h"

using namespace jxglib;

int main()
{
    ::stdio_init_all();
    //-------------------------------------------------------------------------
    USBHost::Initialize();
    USBHost::Keyboard keyboard;
    ::spi_init(spi1, 125 * 1000 * 1000);
    GPIO14.set_function_SPI1_SCK();
    GPIO15.set_function_SPI1_TX();
    ST7789 display(spi1, 240, 320, {RST: GPIO10, DC: GPIO11, CS: GPIO12, BL: GPIO13});
    Display::Terminal terminal;
    terminal.Initialize().AttachDisplay(display.Initialize(Display::Dir::Rotate90))
        .AttachKeyboard(keyboard.SetCapsLockAsCtrl()).SetFont(Font::shinonome16);
    Shell::AttachTerminal(terminal);
    //-------------------------------------------------------------------------
    terminal.Println("Shell with ST7789 TFT LCD");
    for (;;) Tickable::Tick();
}
```

OLED SSD1306 と USB キーボードを使う

```cpp
#include <stdio.h>
#include "pico/stdlib.h"
#include "jxglib/SSD1306.h"
#include "jxglib/USBHost.h"
#include "jxglib/Shell.h"
#include "jxglib/Font/shinonome12.h"

using namespace jxglib;

int main()
{
    ::stdio_init_all();
    //-------------------------------------------------------------------------
    USBHost::Initialize();
    USBHost::Keyboard keyboard;
    ::i2c_init(i2c0, 400 * 1000);
    GPIO4.set_function_I2C0_SDA().pull_up();
    GPIO5.set_function_I2C0_SCL().pull_up();
    SSD1306 display(i2c0, 0x3c);
    Display::Terminal terminal;
    terminal.Initialize().AttachDisplay(display.Initialize())
        .AttachKeyboard(keyboard.SetCapsLockAsCtrl()).SetFont(Font::shinonome12);
    Shell::AttachTerminal(terminal);
    //-------------------------------------------------------------------------
    terminal.Println("Shell with SSD1306");
    for (;;) Tickable::Tick();
}
```

---
title: "pico-jxglib ã§ Pico ãƒœãƒ¼ãƒ‰ã« USB ã‚²ãƒ¼ãƒ ãƒ‘ãƒƒãƒ‰ã‚’æ¥ç¶šã—ã¦ã‚²ãƒ¼ãƒ ã‚’æ¥½ã—ã‚€è©±"
emoji: "ğŸ®"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["çµ„ã¿è¾¼ã¿", "raspberrypi", "pico", "raspberrypipico", "usb"]
published: true
---
**pico-jxglib** ã¯ã€ãƒ¯ãƒ³ãƒœãƒ¼ãƒ‰ãƒã‚¤ã‚³ãƒ³ Raspberry Pi Pico ã® Pico SDK ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚

https://zenn.dev/ypsitau/articles/2025-01-24-jxglib-intro

ä»¥å‰ã«[ã€Œpico-jxglib ã§ Pico ãƒœãƒ¼ãƒ‰ã« USB ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒ»ãƒã‚¦ã‚¹ã‚’æ¥ç¶šã™ã‚‹è©±ã€](https://zenn.dev/ypsitau/articles/2025-04-02-usbhost-keyboard-mouse)ã¨ã„ã†è¨˜äº‹ã‚’ä¸Šã’ã¾ã—ãŸãŒã€ä»Šå›ã¯ Pico ã® USB ãƒ›ã‚¹ãƒˆæ©Ÿèƒ½ã‚’ä½¿ã£ã¦ã€Pico ãƒœãƒ¼ãƒ‰ã« USB ã‚²ãƒ¼ãƒ ãƒ‘ãƒƒãƒ‰ã‚’æ¥ç¶šã—ã¾ã™ã€‚ã‚²ãƒ¼ãƒ ã‚‚æ¥½ã—ã¿ã¾ã™ã‚ˆã€‚

## USB ã‚²ãƒ¼ãƒ ãƒ‘ãƒƒãƒ‰ã«ã¤ã„ã¦

ã‚²ãƒ¼ãƒ ãƒ‘ãƒƒãƒ‰ã¯ãã®åã®é€šã‚Šã€æœ¬æ¥ã‚²ãƒ¼ãƒ ã‚’æ¥½ã—ã‚€ãŸã‚ã®ãƒ‡ãƒã‚¤ã‚¹ã§ã™ãŒã€ãƒ­ãƒœãƒƒãƒˆã‚’æ“ä½œã™ã‚‹ãƒãƒ‹ãƒ”ãƒ¥ãƒ¬ãƒ¼ã‚¿ã¨ã—ã¦ã‚‚å½¹ç«‹ã¡ã¾ã™ã€‚ã‚¢ãƒŠãƒ­ã‚°ã‚¸ãƒ§ã‚¤ã‚¹ãƒ†ã‚£ãƒƒã‚¯ãŒå·¦å³ã§ 2 å€‹ã€åå­—ã‚­ãƒ¼å…¥åŠ›ã€10 å€‹ä»¥ä¸Šã®ãƒœã‚¿ãƒ³ã¨ã„ã†è±Šå¯Œãªå…¥åŠ›æ‰‹æ®µã‚’å‚™ãˆã¦ãŠã‚Šã€ãã‚Œã‚‰ãŒå·¦å³ã®æ‰‹ã§åŠ¹ç‡ã‚ˆãæ“ä½œã§ãã‚‹ã‚ˆã†ãªç­ä½“ã«åã‚ã‚‰ã‚Œã¦ã„ã‚‹ã®ã§ã€ã“ã‚ŒãŒæ•°åƒå††ã§å…¥æ‰‹ã§ãã‚‹ã®ã¯éå¸¸ã«é­…åŠ›çš„ã§ã™ã€‚

ãŸã ã€å¤šãã®ãƒ¡ãƒ¼ã‚«ãŒã„ã‚ã„ã‚ãªä»•æ§˜ã§è£½å“ã‚’å‡ºã—ã¦ããŸãŸã‚ã€è¦æ ¼ã¨ã—ã¦ã¯ã‹ãªã‚Šæ··æ²Œã¨ã—ã¦ã„ã¾ã™ã€‚ã©ã®è£½å“ã‚’é¸ã¹ã°ã‚ˆã„ã‹æŒ‡æ¨™ã«ã‚‚ãªã‚‹ã¨æ€ã†ã®ã§ã€ä»¥ä¸‹ã«ã‚²ãƒ¼ãƒ ãƒ‘ãƒƒãƒ‰ã®ä»•æ§˜ã«ã¤ã„ã¦ç°¡å˜ã«ã¾ã¨ã‚ã¾ã™ã€‚

### DirectInput ã¨ XInput

USB ã‚²ãƒ¼ãƒ ãƒ‘ãƒƒãƒ‰ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®è¦æ ¼ã«ã¯ **DirectInput** ã¨ **XInput** ã®äºŒã¤ãŒå­˜åœ¨ã—ã¾ã™ã€‚**pico-jxglib** ã¯ **DirectInput** ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚

**DirectInput** ã¯å¤ãã‹ã‚‰ã‚ã‚‹è¦æ ¼ã§ã€USB ã® HID ã‚¯ãƒ©ã‚¹ã¨ã—ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚HID ã‚¯ãƒ©ã‚¹ã¯ã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒ»ãƒã‚¦ã‚¹ãƒ»ãƒœã‚¿ãƒ³ãƒ»ã‚¢ãƒŠãƒ­ã‚°ã‚¸ãƒ§ã‚¤ã‚¹ãƒ†ã‚£ãƒƒã‚¯ãƒ»ã‚¿ãƒƒãƒãƒ‘ãƒãƒ«ãƒ»ãƒã‚¤ãƒ³ãƒ†ã‚£ãƒ³ã‚°ãƒ‡ãƒã‚¤ã‚¹ãªã©ã€æ§˜ã€…ãªãƒ’ãƒ¥ãƒ¼ãƒãƒ³ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«å¯¾å¿œã™ã‚‹ãŸã‚ã€ã“ã‚Œã‚‰ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ãƒ‡ãƒã‚¤ã‚¹å´ã§å®šç¾©ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ Report Descriptor ã¨ã„ã†ä»•æ§˜ã‚’å®šã‚ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ãƒœã‚¿ãƒ³ãªã©ã®é…ç½®ã‚„æ•°ã‚’è‡ªç”±ã«ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã—ãŸãƒ‡ãƒã‚¤ã‚¹ã‚’ä½œã‚Œã‚‹ã®ã§ã™ãŒã€æŸ”è»Ÿæ€§ã®è±Šå¯Œã•ã¯ç„¡ç§©åºã«ã¤ãªãŒã‚Šã¾ã™ã€‚è£½å“ã«ã‚ˆã£ã¦ãƒ¬ãƒãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ä¸­ã®ãƒ“ãƒƒãƒˆé…ç½®ãŒç•°ãªã‚‹ã®ã¯ã‚ˆã„ã®ã§ã™ãŒã€Report Descriptor ä¸­ã§ãƒœã‚¿ãƒ³ãªã©ã®ç”¨é€”ã‚’å®šã‚ãŸ Usage å€¤ã®è§£é‡ˆã‚‚ã€ãƒ¡ãƒ¼ã‚«ã”ã¨ã€ã¨ãã«ã‚ˆã£ã¦ã¯åŒã˜ãƒ¡ãƒ¼ã‚«ã§ã‚‚è£½å“ã”ã¨ã«ç•°ãªã‚Šã¾ã™ã€‚PC ç”¨ã®ãƒãƒ«ãƒãƒ¡ãƒ‡ã‚£ã‚¢ãƒ©ã‚¤ãƒ–ãƒ©ãƒª SDL ã¯ã‚²ãƒ¼ãƒ ãƒ‘ãƒƒãƒ‰ã® API ã‚‚æä¾›ã—ã¾ã™ãŒã€ã“ã®å·®ç•°ã‚’[ãƒ‡ãƒã‚¤ã‚¹ã”ã¨ã®ãƒ‡ãƒ¼ã‚¿ãƒ¼ãƒ™ãƒ¼ã‚¹](https://github.com/mdqinc/SDL_GameControllerDB)ã§å€‹åˆ¥ã«å¸åã—ã¦ã„ã¾ã™ã€‚

**XInput** ã¯ Microsoft ãŒã‚²ãƒ¼ãƒ ã‚³ãƒ³ã‚½ãƒ¼ãƒ« XBox ã‚’é–‹ç™ºã™ã‚‹éš›ã«æå”±ã—ãŸã‚²ãƒ¼ãƒ ãƒ‘ãƒƒãƒ‰å°‚ç”¨ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§ã™ã€‚DirectInput ã®ä»•æ§˜ãŒã‚ã¾ã‚Šã«ã‚‚ç„¡ç§©åºã«ãªã£ãŸã®ã‚’å«Œã£ãŸã®ã‹ã€ãƒœã‚¿ãƒ³ã‚„ã‚¸ãƒ§ã‚¤ã‚¹ãƒ†ã‚£ãƒƒã‚¯ã®é…ç½®ã‚„æ•°ã‚’å®Œå…¨ã«è¦å®šã—ã¦ã„ã¾ã™ã€‚ãŸã ã€HID ã‚¯ãƒ©ã‚¹ã§ã¯ãªãã€Vendor ID ãŒ `0x045E` (Microsoft)ã€Product ID ãŒ `0x028E` (XBox360 Controller) ãªã©ã®ãƒ™ãƒ³ãƒ€ãƒ¼å›ºæœ‰ã‚¯ãƒ©ã‚¹ã¨ã—ã¦æ‰±ã‚ã‚Œã¾ã™ã€‚ãƒ™ãƒ³ãƒ€ãƒ¼å›ºæœ‰ã‚¯ãƒ©ã‚¹ã§ã™ã‹ã‚‰ã€ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãŒ XInput ã«å¯¾å¿œã™ã‚‹éš›ã«ã¯ã€INF ãƒ•ã‚¡ã‚¤ãƒ«ãªã©ã‚’ä½¿ã£ã¦è‡ªç¤¾ã® Vendor ID ãŠã‚ˆã³ Product ID ã‚’ OS ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™[^vendorid]ã€‚

[^vendorid]: ã‚²ãƒ¼ãƒ ãƒ‘ãƒƒãƒ‰ã«ã‚ˆã£ã¦ã¯ã€Microsoft ã® Vendor ID ã‚„ Product ID ã‚’è‡ªç¤¾ã®è£½å“ã«å‹æ‰‹ã«ã¤ã‘ã¦ã—ã¾ã£ã¦ã„ã‚‹ã‚‚ã®ã‚‚å­˜åœ¨ã—ã¾ã™ã€‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä½œæ¥­ãªã—ã§æ¥ç¶šã§ãã‚‹ç°¡ä¾¿ã•ã‚’å¾—ã‚ˆã†ã¨ã—ãŸã®ã§ã—ã‚‡ã†ãŒã€ãƒ‡ãƒã‚¤ã‚¹è©ç§°ã¨ã‚‚ã„ãˆã¾ã™ã®ã§ã€å•é¡ŒãŒã‚ã‚Šãã†ã§ã™ã€‚

ã‚µãƒ¼ãƒ‰ãƒ™ãƒ³ãƒ€ãŒæä¾›ã—ã¦ã„ã‚‹ã‚²ãƒ¼ãƒ ãƒ‘ãƒƒãƒ‰ã«ã¯ã€DirectInput ã¨ XInput ã‚’ã‚¹ã‚¤ãƒƒãƒã§åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã‚‚ã®ãŒå¤šãå­˜åœ¨ã—ã¾ã™ã€‚ãŸã ã— XBox ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã¨éŠ˜æ‰“ã£ã¦ç™ºå£²ã—ã¦ã„ã‚‹ã‚²ãƒ¼ãƒ ãƒ‘ãƒƒãƒ‰ã¯ã€å½“ç„¶ XInput ã®ã¿ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚

### Pico ãƒœãƒ¼ãƒ‰ã«æ¥ç¶šã§ãã‚‹ USB ã‚²ãƒ¼ãƒ ãƒ‘ãƒƒãƒ‰

å¸‚è²©ã•ã‚Œã¦ã„ã‚‹å…¨ã¦ã® USB ã‚²ãƒ¼ãƒ ãƒ‘ãƒƒãƒ‰ã®ä¸­ã§ã€Pico ãƒœãƒ¼ãƒ‰ã«æ¥ç¶šã§ãã‚‹ã‚‚ã®ã¯ã‹ãªã‚Šé™å®šã•ã‚Œã¾ã™ã€‚ç•°ãªã‚‹ãƒ™ãƒ³ãƒ€ã‹ã‚‰ 3 å€‹ã®ã‚²ãƒ¼ãƒ ãƒ‘ãƒƒãƒ‰ã‚’å…¥æ‰‹ã—ã¾ã—ãŸãŒã€æ¥ç¶šã§ããŸã®ã¯ãã®ã†ã¡ã®ä¸€ã¤ã§ã—ãŸã€‚

- EasySMX ç¤¾ã®ãƒ¯ã‚¤ãƒ¤ãƒ¬ã‚¹ã‚¿ã‚¤ãƒ— ESM-9013 ã‚’è©¦ã—ãŸã¨ã“ã‚ã€USB ç«¯å­ã«ãƒ¬ã‚·ãƒ¼ãƒã‚’æ¥ç¶šã—ã¦ã‚‚èªè­˜ãŒã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚æ¥ç¶šã—ãŸçŠ¶æ…‹ã§ãƒœãƒ¼ãƒ‰ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹ã¨èªè­˜ã™ã‚‹ã®ã§ã™ãŒã€USB ãƒãƒ–ã‚’çµŒç”±ã™ã‚‹ã¨ã‚„ã¯ã‚Šä¸å®‰å®šã§ã™ã€‚æ¥ç¶šã«æˆåŠŸã—ãŸå¾Œã¯ã€ãƒ¬ãƒãƒ¼ãƒˆã®å—ä¿¡ãŒæ­£å¸¸ã«è¡Œãˆã¾ã—ãŸã€‚

- Logicool ç¤¾ã®æœ‰ç·šã‚¿ã‚¤ãƒ— F310 ã¯ã‹ãªã‚Šãƒ¡ã‚¸ãƒ£ãƒ¼ãªè£½å“ã§ã™ãŒã€ä»Šã®ã¨ã“ã‚ä½¿ãˆã¦ã„ã¾ã›ã‚“ã€‚ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®æ¥ç¶šæ€§ã«å•é¡Œã¯ãªãã€Descriptor ã®å–å¾—ã¾ã§ã¯æˆåŠŸã™ã‚‹ã®ã§ã™ãŒã€ãƒ¬ãƒãƒ¼ãƒˆã®å—ä¿¡ãŒã§ãã¾ã›ã‚“ã€‚ä½•ã‹ã®ãã£ã‹ã‘ã§å—ä¿¡ãŒã§ããŸã“ã¨ã‚‚ã‚ã£ãŸã®ã§ tinyusb ã®ä¿®æ­£ã§è§£æ±ºã™ã‚‹ã¨æ€ã†ã®ã§ã™ãŒã€åŸå› ã¯ä¸æ˜ã§ã™ã€‚

- **Elecom ç¤¾ã®ãƒ¯ã‚¤ãƒ¤ãƒ¬ã‚¹ã‚¿ã‚¤ãƒ— JC-U4113S** ãŒæ‰‹å…ƒã«ã‚ã‚‹ä¸­ã§ã¯å”¯ä¸€ä½¿ãˆã‚‹ã‚²ãƒ¼ãƒ ãƒ‘ãƒƒãƒ‰ã¨ãªã‚Šã¾ã—ãŸã€‚

## Report Descriptor ãƒ‘ãƒ¼ã‚µã«ã¤ã„ã¦

USB HID ã‚¯ãƒ©ã‚¹ã®ãƒ‡ãƒã‚¤ã‚¹ã¯ report ã¨å‘¼ã°ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€å®šå‘¨æœŸã”ã¨ã«ãƒ›ã‚¹ãƒˆã«é€å‡ºã—ã¾ã™ãŒã€ã“ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¯ Report Descriptor ã§å®šç¾©ã•ã‚Œã¾ã™ã€‚Report Descriptor ã¯ã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã€ãƒœã‚¿ãƒ³ã€ã‚¸ãƒ§ã‚¤ã‚¹ãƒ†ã‚£ãƒƒã‚¯ãªã©ã®æƒ…å ±ãŒ report ä¸­ã«æ ¼ç´ã•ã‚Œã¦ã„ã‚‹ä½ç½®ã‚„ã€æœ€å¤§ãƒ»æœ€å°å€¤ã€ä½¿ç”¨ç”¨é€”ãªã©ã®æƒ…å ±ã‚’æä¾›ã—ã¾ã™ã€‚

æ§˜ã€…ãªãƒ‡ãƒ¼ã‚¿ã«å¯¾å¿œã™ã‚‹ãŸã‚ã€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä»•æ§˜ã¯å°‘ã€…è¤‡é›‘ã§ã™ã€‚ä»Šå›ã€USB ã‚²ãƒ¼ãƒ ãƒ‘ãƒƒãƒ‰ã‹ã‚‰æƒ…å ±ã‚’å¾—ã‚‹éš›ã€ãŸã‹ã ã‹æ•°åãƒã‚¤ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã†ãŸã‚ã«å¤§å±¤ãªãƒ‘ãƒ¼ã‚µã‚’ä½œã‚‹ã“ã¨ã«ã¯ãŸã‚ã‚‰ã„ãŒã‚ã‚Šã¾ã—ãŸã€‚ç‰¹å®šã® USB ã‚²ãƒ¼ãƒ ãƒ‘ãƒƒãƒ‰ã«å¯¾å¿œã•ã›ã‚‹ã®ãªã‚‰ã°ã€æ§‹é€ ä½“ãªã©ã‚’ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã™ã‚Œã°ã‚ˆã„ã®ã§ã™ã‹ã‚‰ã€‚å®Ÿéš›ã€tinyusb ã®ã‚µãƒ³ãƒ—ãƒ«ã«ã‚²ãƒ¼ãƒ ãƒ‘ãƒƒãƒ‰ã‚’æ‰±ã†ã‚‚ã®ãŒã‚ã‚Šã¾ã™ãŒã€ãã‚Œã¯ãã®ã‚ˆã†ã«å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

ã§ã‚‚ã€ã©ã†ã—ã¦ã‚‚ã‚€ãšã‚€ãšã¨è½ã¡ç€ã‹ãªãã¦ã€Report Descriptor ã®æƒ…å ±ã‚’ã™ã¹ã¦å¾—ã‚‰ã‚Œã‚‹ã‚ˆã†ãªãƒ‘ãƒ¼ã‚µã‚’çµ„ã¿è¾¼ã¿ã¾ã—ãŸã€‚ã“ã‚Œã§ã„ã‚ã„ã‚ãªã‚²ãƒ¼ãƒ ãƒ‘ãƒƒãƒ‰ã«å¯¾å¿œã§ãã‚‹ã¯ãšã§ã™ãŒã€ãã‚Œä»¥å¤–ã®ç”¨é€”ã«ã‚‚ä½¿ã‚ãªã„ã¨ã‚‚ã£ãŸã„ãªã„ã®ã§ã€ç‹¬ç«‹ã—ãŸè¨˜äº‹ã«è©³ç´°ã‚’è¨˜ã—ãŸã„ã¨æ€ã£ã¦ã„ã¾ã™ã€‚

## é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

Visual Studio Code ã‚„ Git ãƒ„ãƒ¼ãƒ«ã€Pico SDK ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒæ¸ˆã‚“ã§ã„ãªã„æ–¹ã¯[ã€ŒPico SDK ã“ã¨ã¯ã˜ã‚ã€](https://zenn.dev/ypsitau/articles/2025-01-17-picosdk#%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83) ã‚’ã”è¦§ãã ã•ã„ã€‚

GitHub ã‹ã‚‰ **pico-jxglib** ã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¾ã™ã€‚

```bash
git clone https://github.com/ypsitau/pico-jxglib.git
cd pico-jxglib
git submodule update --init
```

:::message
**pico-jxglib** ã¯ã»ã¼æ¯æ—¥æ›´æ–°ã•ã‚Œã¦ã„ã¾ã™ã€‚ã™ã§ã«ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¦ã„ã‚‹å ´åˆã¯ã€`pico-jxglib` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦æœ€æ–°ã®ã‚‚ã®ã«ã—ã¦ãã ã•ã„ã€‚

```bash
git pull
```

:::

## ãƒ¢ãƒ‹ã‚¿ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ä½œæˆ

ã‚²ãƒ¼ãƒ ãƒ‘ãƒƒãƒ‰ã®ãƒœã‚¿ãƒ³ã‚„ã‚¸ãƒ§ã‚¤ã‚¹ãƒ†ã‚£ãƒƒã‚¯æƒ…å ±ã‚’ TFT LCD ã«è¡¨ç¤ºã™ã‚‹ãƒ¢ãƒ‹ã‚¿ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œæˆã—ã¾ã™ã€‚

### é…ç·šã‚¤ãƒ¡ãƒ¼ã‚¸

TFT LCD ã« ILI9341 ã‚’ä½¿ã†ãƒ–ãƒ¬ãƒƒãƒ‰ãƒœãƒ¼ãƒ‰ã®é…ç·šã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ã€‚USB ã‚²ãƒ¼ãƒ ãƒ‘ãƒƒãƒ‰ã¯ã€microB ã‹ã‚‰ A ã‚¿ã‚¤ãƒ—ã«å¤‰æ›ã™ã‚‹ OTG ã‚±ãƒ¼ãƒ–ãƒ«ã§æ¥ç¶šã—ã¾ã™ã€‚åœ§é›»ãƒ–ã‚¶ãƒ¼ãŒã¤ã„ã¦ã„ã‚‹ã®ã¯ã€å¾Œã«ç´¹ä»‹ã™ã‚‹ã‚²ãƒ¼ãƒ ã®ãŸã‚ã§ã™ã€‚

![circuit-ili9341.png](/images/2025-04-23-usbhost-gamepad/circuit-ili9341.png)

TFT LCD ã« ST7789 ã‚’ä½¿ã†ãƒ–ãƒ¬ãƒƒãƒ‰ãƒœãƒ¼ãƒ‰ã®é…ç·šã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ã€‚

![circuit-st7789.png](/images/2025-04-23-usbhost-gamepad/circuit-st7789.png)

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

VSCode ã®ã‚³ãƒãƒ³ãƒ‰ãƒ‘ãƒ¬ãƒƒãƒˆã‹ã‚‰ `>Raspberry Pi Pico: New Pico Project` ã‚’å®Ÿè¡Œã—ã€ä»¥ä¸‹ã®å†…å®¹ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚Pico SDK ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆã®è©³ç´°ã‚„ã€ãƒ“ãƒ«ãƒ‰ã€ãƒœãƒ¼ãƒ‰ã¸ã®æ›¸ãè¾¼ã¿æ–¹æ³•ã«ã¤ã„ã¦ã¯[ã€ŒPico SDK ã“ã¨ã¯ã˜ã‚ã€](https://zenn.dev/ypsitau/articles/2025-01-17-picosdk#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90%E3%81%A8%E7%B7%A8%E9%9B%86) ã‚’å‚ç…§ãã ã•ã„ã€‚

- **Name** ... ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’å…¥åŠ›ã—ã¾ã™ã€‚ä»Šå›ã¯ä¾‹ã¨ã—ã¦ `usbhost-gamepad-monitor` ã‚’å…¥åŠ›ã—ã¾ã™
- **Board type** ... ãƒœãƒ¼ãƒ‰ç¨®åˆ¥ã‚’é¸æŠã—ã¾ã™
- **Location** ... ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œã‚‹ä¸€ã¤ä¸Šã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’é¸æŠã—ã¾ã™
- **Stdio support** .. ã©ã¡ã‚‰ã‚‚æœªãƒã‚§ãƒƒã‚¯ã®ã¾ã¾ã«ã—ã¦ãŠãã¾ã™
- **Code generation options** ... **`Generate C++ code` ã«ãƒã‚§ãƒƒã‚¯ã‚’ã¤ã‘ã¾ã™**

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ `pico-jxglib` ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ç½®ãŒä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã¨æƒ³å®šã—ã¾ã™ã€‚

```text
â”œâ”€â”€ pico-jxglib/
â””â”€â”€ usbhost-gamepad-monitor/
    â”œâ”€â”€ CMakeLists.txt
    â”œâ”€â”€ usbhost-gamepad-monitor.cpp
    â””â”€â”€ ...
```

`CMakeLists.txt` ã®æœ€å¾Œã«ä»¥ä¸‹ã®è¡Œã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

```cmake:CMakeLists.txt
target_link_libraries(usbhost-gamepad-monitor jxglib_USBHost jxglib_Display_ILI9341 jxglib_Display_ST7789)
add_subdirectory(${CMAKE_CURRENT_LIST_DIR}/../pico-jxglib pico-jxglib)
jxglib_configure_USBHost(usbhost-gamepad-monitor CFG_TUH_HID 3)
```

ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¾ã™ã€‚

```cpp:usbhost-gamepad-monitor.cpp
#include <stdio.h>
#include "pico/stdlib.h"
#include "jxglib/Display/ILI9341.h"
#include "jxglib/Display/ST7789.h"
#include "jxglib/USBHost/HID.h"
#include "jxglib/Font/naga10.h"

using namespace jxglib;

int main()
{
    ::stdio_init_all();
    ::spi_init(spi0, 125 * 1000 * 1000);
    GPIO18.set_function_SPI0_SCK();
    GPIO19.set_function_SPI0_TX();
    Display::Terminal terminal;
    ILI9341 display(spi0, 240, 320, {RST: GPIO13, DC: GPIO12, CS: GPIO11, BL: GPIO::None});
    //ST7789 display(spi0, 240, 320, {RST: GPIO13, DC: GPIO12, CS: GPIO11, BL: GPIO::None});
    display.Initialize(Display::Dir::Rotate270);
    terminal.Initialize().AttachDisplay(display).SetFont(Font::naga10);
    USBHost::Initialize();
    USBHost::GamePad gamePad;
    terminal.Printf("USB GamePad Monitor\n");
    for (;;) {
        if (gamePad.HasReportChanged()) {
            terminal.Printf("%s%s%s%s%s%s%s%s%s%s%s%s%s %X % 1.2f% 1.2f% 1.2f% 1.2f% 1.2f% 1.2f% 1.2f% 1.2f% 1.2f\n",
                gamePad.Get_Button0()? "0" : ".",
                gamePad.Get_Button1()? "1" : ".",
                gamePad.Get_Button2()? "2" : ".",
                gamePad.Get_Button3()? "3" : ".",
                gamePad.Get_Button4()? "4" : ".",
                gamePad.Get_Button5()? "5" : ".",
                gamePad.Get_Button6()? "6" : ".",
                gamePad.Get_Button7()? "7" : ".",
                gamePad.Get_Button8()? "8" : ".",
                gamePad.Get_Button9()? "9" : ".",
                gamePad.Get_Button10()? "A" : ".",
                gamePad.Get_Button11()? "B" : ".",
                gamePad.Get_Button12()? "C" : ".",
                gamePad.Get_HatSwitch(),
                gamePad.Get_Axis0(),
                gamePad.Get_Axis1(),
                gamePad.Get_Axis2(),
                gamePad.Get_Axis3(),
                gamePad.Get_Axis4(),
                gamePad.Get_Axis5(),
                gamePad.Get_Axis6(),
                gamePad.Get_Axis7(),
                gamePad.Get_Axis8());
        }
        Tickable::Sleep(300);
    }
}
```

`USBHost::GamePad` ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã¦ã‚²ãƒ¼ãƒ ãƒ‘ãƒƒãƒ‰ã®æƒ…å ±ã‚’å–å¾—ã—ã¾ã™ã€‚Get_Button0() ï½ Get_Button12() ã¯ãƒœã‚¿ãƒ³æƒ…å ±ã‚’å–å¾—ã™ã‚‹é–¢æ•°ã§ã€æŠ¼ä¸‹çŠ¶æ…‹ã«ã‚ˆã£ã¦ true ã¾ãŸã¯ false ã‚’è¿”ã—ã¾ã™ã€‚Get_Axis0() ï½ Get_Axis8() ã¯ã‚¢ãƒŠãƒ­ã‚°ã‚¸ãƒ§ã‚¤ã‚¹ãƒ†ã‚£ãƒƒã‚¯ã®æ“ä½œé‡ã§ã€-1 ã‹ã‚‰ +1 ã®æ•°å€¤ã‚’è¿”ã—ã¾ã™ã€‚


## ã‚²ãƒ¼ãƒ ãƒ‘ãƒƒãƒ‰ã§ã‚²ãƒ¼ãƒ ã‚’æ¥½ã—ã‚€

ã›ã£ã‹ãã‚²ãƒ¼ãƒ ãƒ‘ãƒƒãƒ‰ã‚’æ¥ç¶šã—ãŸã®ã§ã™ã‹ã‚‰ã€æœ¬æ¥ã®ç›®çš„ã§ã‚ã‚‹ã‚²ãƒ¼ãƒ ã‚’æ¥½ã—ã¿ãŸã„ã‚‚ã®ã§ã™ã€‚[KenKen ã•ã‚“](http://www.ze.em-net.ne.jp/~kenken/index.html) ã® [Raspberry Pi Pico ã«ã‚ˆã‚‹æ¶²æ™¶ã‚²ãƒ¼ãƒ è£½ä½œ](http://www.ze.em-net.ne.jp/~kenken/picogames/index.html) ã§ Pico ãƒœãƒ¼ãƒ‰ã§å‹•ä½œã™ã‚‹ã‚¯ã‚ªãƒªãƒ†ã‚£ã®é«˜ã„ã‚²ãƒ¼ãƒ ã‚’è¦‹ã¤ã‘ã¾ã—ãŸã®ã§ã€ã‚²ãƒ¼ãƒ ãƒ‘ãƒƒãƒ‰ã§ã“ã‚Œã‚‰ã®ã‚²ãƒ¼ãƒ ã‚’éŠã¹ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚

ã‚²ãƒ¼ãƒ ãƒ‘ãƒƒãƒ‰ã®å„éƒ¨ã¸ã®æ“ä½œã®å‰²ã‚Šå½“ã¦ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚å‰è¿°ã—ãŸã‚ˆã†ã«ã€å„ãƒœã‚¿ãƒ³ã‚„ã‚¢ãƒŠãƒ­ã‚°ã‚¸ãƒ§ã‚¤ã‚¹ãƒ†ã‚£ãƒƒã‚¯ãŒå®Ÿéš›ã®ã‚²ãƒ¼ãƒ ãƒ‘ãƒƒãƒ‰ã®ã©ã“ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹ã®ã‹ã¯æ©Ÿç¨®ã«ã‚ˆã£ã¦ç•°ãªã‚Šã¾ã™ãŒã€ã“ã®ç¨‹åº¦ã®å‰²ã‚Šå½“ã¦ãªã‚‰ã°ã ã„ãŸã„å½“ã¦ã¯ã¾ã‚‹ã¨æ€ã„ã¾ã™ (å³ã‚¢ãƒŠãƒ­ã‚°ã‚¸ãƒ§ã‚¤ã‚¹ãƒ†ã‚£ãƒƒã‚¯ã¯é™¤ã)ã€‚

- å·¦å³ã‚¢ãƒŠãƒ­ã‚°ã‚¸ãƒ§ã‚¤ã‚¹ãƒ†ã‚£ãƒƒã‚¯ ... ä¸Šãƒ»ä¸‹ãƒ»å·¦ãƒ»å³
- åå­—ã‚­ãƒ¼ ... ä¸Šãƒ»ä¸‹ãƒ»å·¦ãƒ»å³
- A, B, X, Y ãƒœã‚¿ãƒ³ ... Fire
- ãã®ä»–ã®ãƒœã‚¿ãƒ³ ... Start

é…ç·šã¯ã€[å‰è¿°ã®å›³](#%E9%85%8D%E7%B7%9A%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8)ã‚’å‚ç…§ãã ã•ã„ã€‚

### ãƒ“ãƒ«ãƒ‰æ–¹æ³•

1. ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¾ã™ã€‚

   ```bash
   git clone https://github.com/ypsitau/picopacman
   git clone https://github.com/ypsitau/picotetris
   git clone https://github.com/ypsitau/picoinvader
   git clone https://github.com/ypsitau/picohakomusu
   git clone https://github.com/ypsitau/picopegsol
   git clone https://github.com/ypsitau/pico-jxglib
   cd pico-jxglib
   git submodule update --init
   ```

1. ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã‚²ãƒ¼ãƒ ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»ã‚Šã€`code .` ã‚’å®Ÿè¡Œã—ã¦ VSCode ã‚’èµ·å‹•ã—ã¾ã™ã€‚`Do you want to import this project as Raspberry Pi Pico project?` ã¨ã„ã†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒƒã‚¯ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€`[Yes]` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™

1. `Import Pico Project` ã¨ã„ã†ãƒšã‚¤ãƒ³ãŒé–‹ãã®ã§ã€å†…å®¹ã‚’ç¢ºèªã—ã¦ `[Import]` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™

1. ã‚³ãƒãƒ³ãƒ‰ãƒ‘ãƒ¬ãƒƒãƒˆã‹ã‚‰ `>Raspberry Pi Pico: Switch Board` ã‚’å®Ÿè¡Œã—ã¦ã€ä½¿ç”¨ã™ã‚‹ãƒœãƒ¼ãƒ‰ã‚’é¸æŠã—ã¾ã™

1. ã‚³ãƒãƒ³ãƒ‰ãƒ‘ãƒ¬ãƒƒãƒˆã‹ã‚‰ `>CMake: Build` ã‚’å®Ÿè¡Œã€ã¾ãŸã¯ `[F7]` ã‚­ãƒ¼ã‚’æŠ¼ã—ã¾ã™ã€‚`Select a kit for project` ã¨ã„ã†ã‚³ãƒ³ãƒœãƒœãƒƒã‚¯ã‚¹ãŒå‡ºã‚‹ã®ã§ `Pico Using compilers:...` ã‚’é¸æŠã—ã¦ãƒ“ãƒ«ãƒ‰ã‚’è¡Œã„ã¾ã™

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ ILI9341 ã‚’ TFT LCD ã«ä½¿ç”¨ã™ã‚‹è¨­å®šã«ãªã£ã¦ã„ã¾ã™ã€‚ST7789 ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ `ili9341_spi.c` ä¸­ã«è¨˜è¿°ã•ã‚Œã¦ã„ã‚‹ã€€`//#define USE_ST7789` ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’å¤–ã—ã¦ãã ã•ã„ã€‚

### ãƒ‘ãƒƒã‚¯ãƒãƒ³

UF2 ãƒ•ã‚¡ã‚¤ãƒ«

- [Pico ãƒœãƒ¼ãƒ‰ + ILI9341](https://github.com/ypsitau/picopacman/raw/refs/heads/main/bin/lcd-pacman-pico-ili9341.uf2)
- [Pico ãƒœãƒ¼ãƒ‰ + ST7789](https://github.com/ypsitau/picopacman/raw/refs/heads/main/bin/lcd-pacman-pico-st7789.uf2)
- [Pico2 ãƒœãƒ¼ãƒ‰ + ILI9341](https://github.com/ypsitau/picopacman/raw/refs/heads/main/bin/lcd-pacman-pico2-ili9341.uf2)
- [Pico2 ãƒœãƒ¼ãƒ‰ + ST7789](https://github.com/ypsitau/picopacman/raw/refs/heads/main/bin/lcd-pacman-pico2-st7789.uf2)

![picopacman.jpg](/images/2025-04-23-usbhost-gamepad/picopacman.jpg)

### ãƒ†ãƒˆãƒªã‚¹

UF2 ãƒ•ã‚¡ã‚¤ãƒ«

- [Pico ãƒœãƒ¼ãƒ‰ + ILI9341](https://github.com/ypsitau/picotetris/raw/refs/heads/main/bin/tetrispico-pico-ili9341.uf2)
- [Pico ãƒœãƒ¼ãƒ‰ + ST7789](https://github.com/ypsitau/picotetris/raw/refs/heads/main/bin/tetrispico-pico-st7789.uf2)
- [Pico2 ãƒœãƒ¼ãƒ‰ + ILI9341](https://github.com/ypsitau/picotetris/raw/refs/heads/main/bin/tetrispico-pico2-ili9341.uf2)
- [Pico2 ãƒœãƒ¼ãƒ‰ + ST7789](https://github.com/ypsitau/picotetris/raw/refs/heads/main/bin/tetrispico-pico2-st7789.uf2)

![picopacman.jpg](/images/2025-04-23-usbhost-gamepad/picotetris.jpg)

### ã‚¤ãƒ³ãƒ™ãƒ¼ãƒ€ãƒ¼ã‚²ãƒ¼ãƒ 

UF2 ãƒ•ã‚¡ã‚¤ãƒ«

- [Pico ãƒœãƒ¼ãƒ‰ + ILI9341](https://github.com/ypsitau/picoinvader/raw/refs/heads/main/bin/invaderpico-pico-ili9341.uf2)
- [Pico ãƒœãƒ¼ãƒ‰ + ST7789](https://github.com/ypsitau/picoinvader/raw/refs/heads/main/bin/invaderpico-pico-st7789.uf2)
- [Pico2 ãƒœãƒ¼ãƒ‰ + ILI9341](https://github.com/ypsitau/picoinvader/raw/refs/heads/main/bin/invaderpico-pico2-ili9341.uf2)
- [Pico2 ãƒœãƒ¼ãƒ‰ + ST7789](https://github.com/ypsitau/picoinvader/raw/refs/heads/main/bin/invaderpico-pico2-st7789.uf2)

![picopacman.jpg](/images/2025-04-23-usbhost-gamepad/picoinvader.jpg)

### ç®±å…¥ã‚Šå¨˜ãƒ‘ã‚ºãƒ«

![picopacman.jpg](/images/2025-04-23-usbhost-gamepad/picohakomusu.jpg)

### ãƒšã‚°ã‚½ãƒªãƒ†ã‚£ã‚¢

![picopacman.jpg](/images/2025-04-23-usbhost-gamepad/picopegsol.jpg)

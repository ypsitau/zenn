---
title: "pico-jxglib ã¨ LVGL ã®è©±"
emoji: "ğŸ™†"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["çµ„ã¿è¾¼ã¿", "raspberrypi", "pico", "raspberrypipico", "lvgl"]
published: true
---
**pico-jxglib** ã¯ã€ãƒ¯ãƒ³ãƒœãƒ¼ãƒ‰ãƒã‚¤ã‚³ãƒ³ Raspberry Pi Pico ã® Pico SDK ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚

https://zenn.dev/ypsitau/articles/2025-01-24-jxglib-intro

ä»Šå›ã¯ã€**pico-jxglib** ã‚’ä½¿ã£ã¦ã€LVGL ã«ã‚ˆã‚‹é«˜åº¦ãª GUI ã‚’ TFT LCD ä¸Šã«å®Ÿè£…ã—ã¾ã™ã€‚ã‚¿ãƒƒãƒã‚¹ã‚¯ãƒªãƒ¼ãƒ³ä»˜ãã® TFT LCD ãŒã€æ±ç”¨ã®å…¥åŠ›ãƒ‡ãƒã‚¤ã‚¹ã«ãªã‚Šã¾ã™ã‚ˆãƒ¼ã€‚

## LVGL ã«ã¤ã„ã¦

[LVGL](https://docs.lvgl.io/) ã¯ã€é™ã‚‰ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹ã—ã‹æŒãŸãªã„çµ„ã¿è¾¼ã¿æ©Ÿå™¨ã§é«˜åº¦ãª GUI ã‚’å®Ÿç¾ã§ãã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚æœ€å°ã®ç’°å¢ƒã§ 16MHz ã® CPUã€64KB ã® Flash ãƒ¡ãƒ¢ãƒªã¨ 16KB ã® RAM ãŒã‚ã‚Œã°å‹•ä½œã—ã¾ã™ã€‚125MHz ã® CPUã€2MB ã® Flash ãƒ¡ãƒ¢ãƒªã¨ 264KB ã® SRAM ã‚’æ­è¼‰ã—ãŸ Pico ãªã‚‰ã°ã€ã‹ãªã‚Šã®ä½™è£•ã‚’æŒã£ã¦å‹•ã‹ã™ã“ã¨ãŒã§ãã¾ã™ã­ï¼

å°‘ãªã„æ¶ˆè²»ãƒªã‚½ãƒ¼ã‚¹ã«ã‚‚ã‹ã‹ã‚ã‚‰ãšã€è¡¨ç¾èƒ½åŠ›ã¯éå¸¸ã«é«˜ã„ã§ã™ã€‚ä»¥ä¸‹ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã¯ LVGL ãŒæä¾›ã—ã¦ã„ã‚‹ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ã²ã¨ã¤ã§ã™ã€‚

![lvgl-bezier-anim.png](/images/2025-02-04-lvgl/lvgl-bezier-anim.png) (LVGL ã®ãƒšãƒ¼ã‚¸ã‹ã‚‰è»¢è¼‰)

ã‚¹ãƒ©ã‚¤ãƒ‰ãƒãƒ¼ã‚’æ“ä½œã™ã‚‹ã¨ãã‚Œãã‚Œã®å€¤ã‚’åˆ¶å¾¡ç‚¹ã¨ã—ãŸãƒ™ã‚¸ã‚¨æ›²ç·šã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã‚°ãƒ©ãƒ•ä¸­ã«æç”»ã—ã¾ã™ã€‚ã•ã‚‰ã«å³å´ã®å†ç”Ÿãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€æ›²ç·šã«å¿œã˜ãŸé€Ÿåº¦ã§ä¸Šéƒ¨ã®èµ¤ã„å››è§’ãŒå·¦ã‹ã‚‰å³ã«ç§»å‹•ã—ã¾ã™ã€‚å®Ÿéš›ã®å‹•ä½œã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’[ã“ã“](https://docs.lvgl.io/master/examples.html#cubic-bezier-animation)ã§ç¢ºèªã§ãã¾ã™ã€‚ã“ã‚Œã¨ã¾ã£ãŸãåŒã˜ GUI ãŒæ‰‹å…ƒã®ãƒ¯ãƒ³ãƒœãƒ¼ãƒ‰ãƒã‚¤ã‚³ãƒ³ã§å®Ÿç¾ã§ãã‚‹ã®ã§ã™ã‹ã‚‰é©šãã§ã™ã€‚

ã•ã‚‰ã«æ„Ÿå¿ƒã™ã‚‹ã®ã¯ã€å˜ã«å®Ÿç”¨ç›®çš„ã®ä¸€ç‚¹å¼µã‚Šã§ã¯ãªãã€è¦–è¦šè¡¨ç¾ã«éŠã³å¿ƒãŒã‚ãµã‚Œã¦ã„ã‚‹ã“ã¨ã§ã™ã€‚ä¾‹ãˆã°ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã«ã¯ã¶ã‚ã£ã¨åºƒãŒã‚‹ã‚ˆã†ãªè¡¨ç¾åŠ¹æœã‚’ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒã‚€ã‘ã® UI ã«ã‚‚ã‚‚ã£ã¦ã“ã„ã§ã™ã­ã€‚

ã„ã‚ã„ã‚ãªãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¸ã®ãƒãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚‚ [Connecting LVGL to Your Hardware](https://docs.lvgl.io/master/intro/add-lvgl-to-your-project/connecting_lvgl.html#initializing-lvgl) ã«æ²¿ã£ã¦å°‘ãªã„å·¥æ•°ã§è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚**pico-jxglib** ã‚‚ã“ã®æ©æµã«ã‚ãšã‹ã‚‰ã›ã¦ã‚‚ã‚‰ã„ã¾ã—ãŸã€‚

## å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

ã‚¿ãƒƒãƒã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚’æ­è¼‰ã—ãŸ ILI9341 ã‚’æ¥ç¶šã—ã€LVGL ã‚’ä½¿ã£ãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ãªãŠã€ã‚¿ãƒƒãƒã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚’æŒãŸãªã„ãƒ‡ãƒã‚¤ã‚¹ã§ã‚‚ Stdio ã§ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã™ã‚‹æ–¹æ³•ã‚’å¾Œè¿°ã—ã¾ã™ã€‚ã¾ãŸã€USB ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã¨ãƒã‚¦ã‚¹ã§æ“ä½œãŒã§ãã‚‹æ–¹æ³•ã‚’ä»¥ä¸‹ã®è¨˜äº‹ã§èª¬æ˜ã—ã¦ã„ã¾ã™ã€‚

https://zenn.dev/ypsitau/articles/2025-04-02-usbhost-keyboard-mouse#lvgl-%E3%81%A8-usb-%E3%82%AD%E3%83%BC%E3%83%9C%E3%83%BC%E3%83%89%E3%83%BB%E3%83%9E%E3%82%A6%E3%82%B9

### é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

Visual Studio Code ã‚„ Git ãƒ„ãƒ¼ãƒ«ã€Pico SDK ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒæ¸ˆã‚“ã§ã„ãªã„æ–¹ã¯[ã€ŒPico SDK ã“ã¨ã¯ã˜ã‚ã€](https://zenn.dev/ypsitau/articles/2025-01-17-picosdk#%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83) ã‚’ã”è¦§ãã ã•ã„ã€‚

**pico-jxglib** ã¯ GitHub ã‹ã‚‰ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã™ã‚‹ã“ã¨ã§å…¥æ‰‹ã§ãã¾ã™ã€‚

```bash
git clone https://github.com/ypsitau/pico-jxglib.git
cd pico-jxglib
git submodule update --init
```

:::message
**pico-jxglib** ã¯ã»ã¼æ¯æ—¥æ›´æ–°ã•ã‚Œã¦ã„ã¾ã™ã€‚ã™ã§ã«ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¦ã„ã‚‹å ´åˆã¯ã€`pico-jxglib` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦æœ€æ–°ã®ã‚‚ã®ã«ã—ã¦ãã ã•ã„ã€‚

```bash
git pull
```

:::

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

VSCode ã®ã‚³ãƒãƒ³ãƒ‰ãƒ‘ãƒ¬ãƒƒãƒˆã‹ã‚‰ `>Raspberry Pi Pico: New Pico Project` ã‚’å®Ÿè¡Œã—ã€ä»¥ä¸‹ã®å†…å®¹ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚Pico SDK ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆã®è©³ç´°ã‚„ã€ãƒ“ãƒ«ãƒ‰ã€ãƒœãƒ¼ãƒ‰ã¸ã®æ›¸ãè¾¼ã¿æ–¹æ³•ã«ã¤ã„ã¦ã¯[ã€ŒPico SDK ã“ã¨ã¯ã˜ã‚ã€](https://zenn.dev/ypsitau/articles/2025-01-17-picosdk#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90%E3%81%A8%E7%B7%A8%E9%9B%86) ã‚’å‚ç…§ãã ã•ã„ã€‚

- **Name** ... ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’å…¥åŠ›ã—ã¾ã™ã€‚ä»Šå›ã¯ä¾‹ã¨ã—ã¦ `lvgltest` ã‚’å…¥åŠ›ã—ã¾ã™
- **Board type** ... ãƒœãƒ¼ãƒ‰ç¨®åˆ¥ã‚’é¸æŠã—ã¾ã™
- **Location** ... ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œã‚‹ä¸€ã¤ä¸Šã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’é¸æŠã—ã¾ã™
- **Stdio support** .. Stdio ã«æ¥ç¶šã™ã‚‹ãƒãƒ¼ãƒˆ (UART ã¾ãŸã¯ USB) ã‚’é¸æŠã—ã¾ã™
- **Code generation options** ... **`Generate C++ code` ã«ãƒã‚§ãƒƒã‚¯ã‚’ã¤ã‘ã¾ã™**

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ `pico-jxglib` ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ç½®ãŒä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã¨æƒ³å®šã—ã¾ã™ã€‚

```text
â”œâ”€â”€ pico-jxglib/
â””â”€â”€ lvgltest/
    â”œâ”€â”€ CMakeLists.txt
    â”œâ”€â”€ lvgltest.cpp
    â””â”€â”€ ...
```

ä»¥ä¸‹ã€ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚‚ã¨ã« `CMakeLists.txt` ã¨ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¦ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚

### ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãƒ“ãƒ«ãƒ‰ã¨å®Ÿè¡Œ

ãƒ–ãƒ¬ãƒƒãƒ‰ãƒœãƒ¼ãƒ‰ã®é…ç·šã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

![circuit-ili9341-touch.png](/images/2025-02-04-lvgl/circuit-ili9341-touch.png)

`CMakeLists.txt` ã®æœ€å¾Œã«ä»¥ä¸‹ã®è¡Œã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

```cmake:CMakeLists.txt
target_link_libraries(lvgltest jxglib_ILI9341 jxglib_LVGL lvgl_examples)
add_subdirectory(${CMAKE_CURRENT_LIST_DIR}/../pico-jxglib pico-jxglib)
jxglib_configure_LVGL(lvgltest LV_FONT_MONTSERRAT_14)
```

`jxglib_configure_LVGL()` é–¢æ•°ã¯ LVGL ã®ãƒ“ãƒ«ãƒ‰ã«å¿…è¦ãªãƒ˜ãƒƒãƒ€ãƒ•ã‚¡ã‚¤ãƒ« `lv_conf.h` ã‚’ç”Ÿæˆã—ã¾ã™ã€‚å¼•æ•°ã«ã¯ä½¿ç”¨ã™ã‚‹ãƒ•ã‚©ãƒ³ãƒˆã«å¯¾å¿œã™ã‚‹ãƒã‚¯ãƒ­å¤‰æ•°åã‚’ä¸¦ã¹ã¦è¨˜è¿°ã—ã¾ã™ã€‚åˆã‚ã«æŒ‡å®šã—ãŸãƒ•ã‚©ãƒ³ãƒˆãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ•ã‚©ãƒ³ãƒˆã«ãªã‚Šã¾ã™ã€‚

ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¾ã™ã€‚

```cpp:lvgltest.cpp
#include <stdio.h>
#include <examples/lv_examples.h>
#include "pico/stdlib.h"
#include "jxglib/ILI9341.h"
#include "jxglib/LVGL.h"

using namespace jxglib;

int main()
{
    ::stdio_init_all();
    ::spi_init(spi0, 2 * 1000 * 1000);
    ::spi_init(spi1, 125 * 1000 * 1000);
    GPIO2.set_function_SPI0_SCK();
    GPIO3.set_function_SPI0_TX();
    GPIO4.set_function_SPI0_RX();
    GPIO14.set_function_SPI1_SCK();
    GPIO15.set_function_SPI1_TX();
    ILI9341 display(spi1, 240, 320, {RST: GPIO10, DC: GPIO11, CS: GPIO12, BL: GPIO13});
    ILI9341::TouchScreen touchScreen(spi0, {CS: GPIO8, IRQ: GPIO9});
    display.Initialize(Display::Dir::Rotate90);
    touchScreen.Initialize(display);
    //touchScreen.Calibrate(display);
    LVGL::Initialize();
    LVGL::Adapter lvglAdapter;
    lvglAdapter.EnableDoubleBuff().AttachDisplay(display).AttachTouchScreen(touchScreen);
    ::lv_example_anim_3();
    for (;;) {
        ::sleep_ms(5);
        ::lv_timer_handler();
    }
}
```

![lvgltest.jpg](/images/2025-02-04-lvgl/lvgltest.jpg)

### ãƒ—ãƒ­ã‚°ãƒ©ãƒ è§£èª¬

ä¸Šè¨˜ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å‡¦ç†å†…å®¹ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

```cpp
::spi_init(spi0, 2 * 1000 * 1000);
::spi_init(spi1, 125 * 1000 * 1000);
```

ã‚¿ãƒƒãƒã‚¹ã‚¯ãƒªãƒ¼ãƒ³ç”¨ã« SPI0 ã‚’ 2MHzã€TFT LCD ç”¨ã« SPI1 ã‚’ 125MHz ã§åˆæœŸåŒ–ã—ã¾ã™ã€‚

```cpp
GPIO2.set_function_SPI0_SCK();
GPIO3.set_function_SPI0_TX();
GPIO4.set_function_SPI0_RX();
GPIO14.set_function_SPI1_SCK();
GPIO15.set_function_SPI1_TX();
```

GPIO ã‚’ SPI0ã€SPI1 ã®ä¿¡å·ç·šã«å‰²ã‚Šå½“ã¦ã¾ã™ã€‚

```cpp
ILI9341 display(spi1, 240, 320, {RST: GPIO10, DC: GPIO11, CS: GPIO12, BL: GPIO13});
ILI9341::TouchScreen touchScreen(spi0, {CS: GPIO6, IRQ: GPIO7});
display.Initialize(Display::Dir::Rotate90);
touchScreen.Initialize(display);
//touchScreen.Calibrate(display);
```

ILI9341 ã® TFT LCD éƒ¨ã¨ã‚¿ãƒƒãƒã‚¹ã‚¯ãƒªãƒ¼ãƒ³éƒ¨ã« SPI ã¨ GPIO ã‚’å‰²ã‚Šå½“ã¦ã€åˆæœŸåŒ–ã—ã¾ã™ã€‚ã‚¿ãƒƒãƒã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã®ç”»é¢åº§æ¨™ã¸ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã¯ã€æ‰‹å…ƒã®ãƒ‡ãƒã‚¤ã‚¹ã§ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã£ãŸãƒ—ãƒªã‚»ãƒƒãƒˆå€¤ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ãŒã€ãƒ‡ãƒã‚¤ã‚¹ã”ã¨ã®ã°ã‚‰ã¤ããŒã©ã‚Œã ã‘ã‚ã‚‹ã®ã‹ã¯ã¾ã åˆ†ã‹ã£ã¦ã„ã¾ã›ã‚“ã€‚ã‚ã¾ã‚Šãšã‚Œã‚‹ã‚ˆã†ã§ã—ãŸã‚‰ã€`Calibrate()` é–¢æ•°ã®å‘¼ã³å‡ºã—ã‚’æœ‰åŠ¹ã«ã—ã¦ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚

```cpp
LVGL::Initialize();
```

LVGL ã®åˆæœŸåŒ–ã‚’è¡Œã„ã¾ã™ã€‚

```cpp
LVGL::Adapter lvglAdapter;
lvglAdapter.EnableDoubleBuff().AttachDisplay(display).AttachTouchScreen(touchScreen);
```

`LVGL::Adapter` ã‚’ä½¿ã£ã¦ TFT LCD ã‚„ã‚¿ãƒƒãƒã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚’ LVGL ã«æ¥ç¶šã—ã¾ã™ã€‚`EnableDoubleBuff()` ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€æç”»ãƒãƒƒãƒ•ã‚¡ãŒäºŒé‡ã«ãªã‚Šã€DMA ã‚’ä½¿ã†ã“ã¨ã§æç”»é€Ÿåº¦ãŒå‘ä¸Šã—ã¾ã™ã€‚ãŸã ã—ã€æ¶ˆè²»ãƒ¡ãƒ¢ãƒªã¯ 2 å€ã«ãªã‚Šã¾ã™ã€‚

```cpp
::lv_example_anim_3();
```

LVGL ãŒæä¾›ã—ã¦ã„ã‚‹ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¦ã„ã¾ã™ã€‚å†…éƒ¨ã§ã¯ã€ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®ç”Ÿæˆã¨ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã®ç™»éŒ²ãŒè¡Œã‚ã‚Œã¾ã™ã€‚

```cpp
for (;;) {
    ::sleep_ms(5);
    ::lv_timer_handler();
}
```

ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—ã§ã™ã€‚`::lv_timer_handler()` ã§ LVGL ã®å‡¦ç†ãŒè¡Œã‚ã‚Œã¾ã™ã€‚

### ç¨®ã€…ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ©ãƒ 

ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª `pico-jxglib/LVGL/lvgl/examples` ä¸‹ã«ã¯ 100 ã‚’è¶…ãˆã‚‹ LVGL ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã‚‰ã‚’ Pico ãƒœãƒ¼ãƒ‰ã§å®¹æ˜“ã«å®Ÿè¡Œã§ãã‚‹ Pico SDK ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”¨æ„ã—ã¾ã—ãŸã€‚

ä¸Šè¨˜ã¨åŒã˜ãã€TFT LCD ã« ILI9341 ã‚’ä½¿ã„ã¾ã™ã€‚ãƒ–ãƒ¬ãƒƒãƒ‰ãƒœãƒ¼ãƒ‰ã®é…ç·šã‚¤ãƒ¡ãƒ¼ã‚¸ã‚‚åŒã˜ã§ã™ã€‚GPIO ã® UART ãƒãƒ¼ãƒˆ (TX: GPIO0ã€RX: GPIO1) ã« USB-ã‚·ãƒªã‚¢ãƒ«å¤‰æ›å™¨ã‚’ã¤ãªã’ã‚‹ã‹ã€ã¾ãŸã¯ USB ç«¯å­çµŒç”±ã§ PC ã«æ¥ç¶šã—ã€ã‚·ãƒªã‚¢ãƒ«ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã—ã¦ãã ã•ã„ (é€šä¿¡é€Ÿåº¦ã¯ 115200bps)ã€‚

ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª `pico-jxglib/LVGL/test-examples` å†…ã§ VSCode ã‚’é–‹ã„ã¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ“ãƒ«ãƒ‰ãŠã‚ˆã³ãƒœãƒ¼ãƒ‰ã¸ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ æ›¸ãè¾¼ã¿ã‚’è¡Œã„ã¾ã™ã€‚ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã‚·ãƒªã‚¢ãƒ«ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«ä»¥ä¸‹ã®ã‚ˆã†ãªç”»é¢ãŒå‡ºã‚‹ã®ã§ã€å®Ÿè¡Œã™ã‚‹ã‚µãƒ³ãƒ—ãƒ«ã®ç•ªå·ã‚’å…¥åŠ›ã—ã¾ã™ã€‚

```text
--------
  1:anim_1                         52:style_5                       103:keyboard_2
  2:anim_2                         53:style_6                       104:label_1
  3:anim_3                         54:style_7                       105:label_2
 ...
 50:style_3                       101:imagebutton_1                 152:tileview_1
 51:style_4                       102:keyboard_1                    153:win_1
Enter Number:
```

### è¤‡æ•° LCD ã¸ã®è¡¨ç¤º

`LVGL::Adapter` ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¤‡æ•°ç”Ÿæˆã—ã¦ãã‚Œãã‚Œã« TFT LCD ã‚„ã‚¿ãƒƒãƒã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚’æ¥ç¶šã™ã‚‹ã“ã¨ã§ã€è¤‡æ•° LCD ã« LVGL ã® GUI ã‚’è¡¨ç¤ºã§ãã¾ã™ã€‚

ä»Šå›ã®ä¾‹ã§ã¯ ILI9341 ã¨ ILI9488 ã‚’æ¥ç¶šã—ã¾ã™ã€‚ãƒ–ãƒ¬ãƒƒãƒ‰ãƒœãƒ¼ãƒ‰ã®é…ç·šã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

![circuit-ili9341-ili9488-touch.png](/images/2025-02-04-lvgl/circuit-ili9341-ili9488-touch.png)

`CMakeLists.txt` ã®æœ€å¾Œã«ä»¥ä¸‹ã®è¡Œã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

```cmake:CMakeLists.txt
target_link_libraries(lvgltest jxglib_ILI9341 jxglib_ILI9488 jxglib_LVGL lvgl_examples)
add_subdirectory(${CMAKE_CURRENT_LIST_DIR}/../pico-jxglib pico-jxglib)
jxglib_configure_LVGL(lvgltest LV_FONT_MONTSERRAT_14)
```

ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¾ã™ã€‚

```cpp:lvgltest.cpp
#include <stdio.h>
#include <examples/lv_examples.h>
#include "pico/stdlib.h"
#include "jxglib/ILI9341.h"
#include "jxglib/ILI9488.h"
#include "jxglib/LVGL.h"

using namespace jxglib;

int main()
{
    ::stdio_init_all();
    ::spi_init(spi0, 2 * 1000 * 1000);
    ::spi_init(spi1, 125 * 1000 * 1000);
    GPIO2.set_function_SPI0_SCK();
    GPIO3.set_function_SPI0_TX();
    GPIO4.set_function_SPI0_RX();
    GPIO14.set_function_SPI1_SCK();
    GPIO15.set_function_SPI1_TX();
    ILI9341 display1(spi1, 240, 320, {RST: GPIO10, DC: GPIO11, CS: GPIO12, BL: GPIO13});
    ILI9488 display2(spi1, 320, 480, {RST: GPIO18, DC: GPIO19, CS: GPIO20, BL: GPIO21});
    ILI9341::TouchScreen touchScreen1(spi0, {CS: GPIO8, IRQ: GPIO9});
    ILI9488::TouchScreen touchScreen2(spi0, {CS: GPIO16, IRQ: GPIO17});
    display1.Initialize(Display::Dir::Rotate90);
    display2.Initialize(Display::Dir::Rotate90);
    touchScreen1.Initialize(display1);
    touchScreen2.Initialize(display2);
    LVGL::Initialize();
    LVGL::Adapter lvglAdapter1;
    lvglAdapter1.AttachDisplay(display1).AttachTouchScreen(touchScreen1);
    LVGL::Adapter lvglAdapter2;
    lvglAdapter2.SetPartialNum(20).AttachDisplay(display2).AttachTouchScreen(touchScreen2);
    lvglAdapter1.SetDefault();
    ::lv_example_anim_3();
    lvglAdapter2.SetDefault();
    ::lv_example_keyboard_1();
    for (;;) {
        ::sleep_ms(5);
        ::lv_timer_handler();
    }
}
```

![lvgltest-multi.jpg](/images/2025-02-04-lvgl/lvgltest-multi.jpg)

LVGL::Adapter ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«å¯¾ã—ã¦ `SetDefault()` é–¢æ•°ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ãã‚Œä»¥é™ã® LVGL ã®é–¢æ•°å‘¼ã³å‡ºã—ã¯ãã®ã‚¢ãƒ€ãƒ—ã‚¿ã«æ¥ç¶šã—ãŸ LCD ã¸ã®æ“ä½œã«ãªã‚Šã¾ã™ã€‚

`SetPartialNum()` é–¢æ•°ã¯ã€LVGL ãŒç”»é¢å…¨ä½“ã‚’ä½•åˆ†å‰²ã—ã¦æç”»ã™ã‚‹ã‹ã‚’æŒ‡å®šã—ã¾ã™ã€‚æ•°å­—ãŒå¤§ãã„ã»ã©åˆ†å‰²æ•°ãŒå¤šããªã‚‹ã®ã§ã€æç”»ãƒãƒƒãƒ•ã‚¡ã®ã‚µã‚¤ã‚ºã¯å°ã•ãã¦ã™ã¿ã¾ã™ã€‚é€šå¸¸ã®è¨­å®šã§ã¯ 10 åˆ†å‰²ã•ã‚Œã¾ã™ãŒã€ä»Šå›ã®ä¾‹ã§ã¯ LCD ã‚’äºŒã¤æ¥ç¶šã—ã¦ã„ã‚‹ä¸Šã€è¿½åŠ ã—ãŸ ILI9488 ã®ç”»é¢ã‚µã‚¤ã‚ºã¯å¤§ããã€ã¾ãŸãƒ”ã‚¯ã‚»ãƒ«ã‚ãŸã‚Š 3byte å¿…è¦ã«ãªã‚‹ã®ã§ã€Pico ã® RAM å®¹é‡ã‚’è¶…ãˆã¦ã—ã¾ã†ã®ã§ã™ã€‚ãã®ãŸã‚ã€åˆ†å‰²æ•°ã‚’å¤šãã—ã¦ãƒ¡ãƒ¢ãƒªã‚’ç¯€ç´„ã—ã¦ã„ã¾ã™ã€‚

### Stdio ã«ã‚ˆã‚‹æ“ä½œ

LVGL ã®æ“ä½œã¯åŸºæœ¬çš„ã«ã¯ã‚¿ãƒƒãƒã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã«ãªã‚‹ã®ã§ã™ãŒã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã«ã‚ˆã‚‹æ“ä½œã‚‚å¯èƒ½ã§ã™ã€‚ã“ã“ã§ã¯ã€Stdio ã‹ã‚‰ã®å…¥åŠ›ã§ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

TFT LCD ã«ã¯ ST7789 ã‚’ä½¿ã„ã¾ã™ã€‚ãƒ–ãƒ¬ãƒƒãƒ‰ãƒœãƒ¼ãƒ‰ã®é…ç·šã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

![circuit-st7789-uart.png](/images/2025-02-04-lvgl/circuit-st7789-uart.png)

`CMakeLists.txt` ã®æœ€å¾Œã«ä»¥ä¸‹ã®è¡Œã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

```cmake:CMakeLists.txt
target_link_libraries(lvgltest jxglib_ST7789 jxglib_LVGL lvgl_examples)
add_subdirectory(${CMAKE_CURRENT_LIST_DIR}/../pico-jxglib pico-jxglib)
jxglib_configure_LVGL(lvgltest LV_FONT_MONTSERRAT_14)
```

ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¾ã™ã€‚

```cpp:lvgltest.cpp
#include <stdio.h>
#include <examples/lv_examples.h>
#include "pico/stdlib.h"
#include "jxglib/Stdio.h"
#include "jxglib/ST7789.h"
#include "jxglib/LVGL.h"

using namespace jxglib;

int main()
{
    ::stdio_init_all();
    ::spi_init(spi1, 125 * 1000 * 1000);
    GPIO14.set_function_SPI1_SCK();
    GPIO15.set_function_SPI1_TX();
    ST7789 display(spi1, 240, 320, {RST: GPIO10, DC: GPIO11, CS: GPIO12, BL: GPIO13});
    display.Initialize(Display::Dir::Rotate90);
    LVGL::Initialize();
    LVGL::Adapter lvglAdapter;
    lvglAdapter.EnableDoubleBuff().AttachDisplay(display).AttachKeyboard(Stdio::GetKeyboard());
    ::lv_example_keyboard_1();
    for (;;) {
        ::sleep_ms(5);
        ::lv_timer_handler();
    }
}
```

`PgUp` ã¨ `PgDn` ã§ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’ç§»å‹•ã—ã¾ã™ã€‚`Enter` ã§ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã®ã¤ã„ãŸã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’ã€Œã‚¯ãƒªãƒƒã‚¯ã€ã—ã¾ã™ã€‚
